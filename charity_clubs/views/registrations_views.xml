<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Registration Form View -->
        <record id="view_charity_registrations_form" model="ir.ui.view">
            <field name="name">charity.registrations.form</field>
            <field name="model">charity.registrations</field>
            <field name="arch" type="xml">
                <form string="نموذج التسجيل">
                    <header>
                        <button name="action_confirm" string="تأكيد" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                        <button name="action_approve" string="اعتماد" type="object" class="oe_highlight" invisible="state != 'confirmed'" groups="base.group_system"/>
                        <button name="action_reject" string="رفض" type="object" invisible="state not in ('draft', 'confirmed')" groups="base.group_system"/>
                        <button name="action_cancel" string="إلغاء" type="object" invisible="state == 'approved'"/>
                        <button name="action_reset_draft" string="إعادة للمسودة" type="object" invisible="state == 'draft'" groups="base.group_system"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,approved"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="full_name" placeholder="الاسم الثلاثي كما في الهوية..." readonly="state != 'draft'"/>
                            </h1>
                        </div>

                        <group>
                            <group string="معلومات الطالب الأساسية">
                                <field name="birth_date" readonly="state != 'draft'"/>
                                <field name="age" readonly="1"/>
                                <field name="gender" widget="radio" options="{'horizontal': true}" readonly="state != 'draft'"/>
                                <field name="nationality" options="{'no_create': True, 'no_open': True}" readonly="state != 'draft'"/>
                                <field name="student_grade" readonly="state != 'draft'"/>
                                <field name="arabic_education_type" widget="radio" readonly="state != 'draft'"/>
                            </group>
                            <group string="معلومات الهوية">
                                <field name="id_type" widget="radio" options="{'horizontal': true}" readonly="state != 'draft'"/>
                                <field name="id_number" placeholder="أدخل رقم الهوية أو الجواز..." readonly="state != 'draft'"/>
                                <field name="registration_date" readonly="1"/>
                            </group>
                        </group>

                        <group string="بيانات التسجيل" col="4">
                            <field name="registration_type" widget="radio" options="{'horizontal': true}" readonly="state != 'draft'" colspan="4"/>
                            <field name="headquarters_id" options="{'no_create': True}" readonly="state != 'draft'" colspan="2"/>
                            <field name="department_id"
                                   options="{'no_create': True}"
                                   readonly="state != 'draft'"
                                   required="1"
                                   colspan="2"/>
                            <field name="club_id"
                                   options="{'no_create': True}"
                                   readonly="state != 'draft'"
                                   invisible="registration_type != 'club'"
                                   required="registration_type == 'club'"
                                   colspan="2"/>
                            <field name="term_id"
                                   options="{'no_create': True, 'no_open': True}"
                                   readonly="state != 'draft'"
                                   invisible="registration_type != 'club'"
                                   required="registration_type == 'club'"
                                   colspan="2"
                                   context="{'default_club_id': club_id}"
                                   domain="[('club_id', '=', club_id), ('is_active', '=', True)]"/>
                        </group>

                        <notebook>
                            <page string="الخبرات السابقة" name="previous_experience">
                                <group>
                                    <field name="previous_roayati_member" readonly="state != 'draft'"/>
                                    <field name="previous_arabic_club" readonly="state != 'draft'"/>
                                    <field name="previous_qaida_noorania" readonly="state != 'draft'"/>
                                </group>
                                <group string="حفظ القرآن الكريم">
                                    <field name="quran_memorization" nolabel="1" placeholder="اكتب مقدار حفظ الطالب من القرآن الكريم..." readonly="state != 'draft'"/>
                                </group>
                            </page>

                            <page string="معلومات الوالدين" name="parents_info">
                                <group>
                                    <group string="معلومات الأم">
                                        <field name="mother_name" readonly="state != 'draft'"/>
                                        <field name="mother_mobile" widget="phone" readonly="state != 'draft'"/>
                                        <field name="mother_whatsapp" widget="phone" readonly="state != 'draft'"/>
                                    </group>
                                    <group string="معلومات الأب">
                                        <field name="father_name" readonly="state != 'draft'"/>
                                        <field name="father_mobile" widget="phone" readonly="state != 'draft'"/>
                                    </group>
                                </group>
                            </page>

                            <page string="المتطلبات الصحية" name="health_requirements">
                                <group>
                                    <field name="has_health_requirements" readonly="state != 'draft'"/>
                                    <field name="health_requirements"
                                           nolabel="1"
                                           placeholder="يرجى كتابة تفاصيل المتطلبات الصحية أو الاحتياجات الخاصة أو الحساسيات..."
                                           invisible="not has_health_requirements"
                                           required="has_health_requirements"
                                           readonly="state != 'draft'"/>
                                </group>
                                <div class="alert alert-warning" role="alert" invisible="not has_health_requirements">
                                    <i class="fa fa-exclamation-triangle"/> في حال وجود أي متطلبات صحية أو احتياجات خاصة أو حساسيات لدى الطالب يرجى إبلاغ الإدارة لأخذ الاحتياطات اللازمة
                                </div>
                            </page>

                            <page string="المستندات والموافقات" name="documents">
                                <group>
                                    <group string="صور الهوية">
                                        <field name="id_front_file" filename="id_front_filename" readonly="state != 'draft'"/>
                                        <field name="id_front_filename" invisible="1"/>
                                        <field name="id_back_file" filename="id_back_filename" readonly="state != 'draft'"/>
                                        <field name="id_back_filename" invisible="1"/>
                                    </group>
                                    <group string="الموافقات">
                                        <field name="photo_consent" readonly="state != 'draft'"/>
                                        <div class="text-muted" colspan="2">
                                            <i class="fa fa-camera"/> ملاحظة: يتم تصوير الطلاب خلال فعاليات النوادي وتوضع في مواقع التواصل الاجتماعي للجمعية
                                        </div>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>

                    <!-- Chatter -->
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Registration Tree View -->
        <record id="view_charity_registrations_list" model="ir.ui.view">
            <field name="name">charity.registrations.list</field>
            <field name="model">charity.registrations</field>
            <field name="arch" type="xml">
                <list string="التسجيلات" multi_edit="1">
                    <field name="full_name" string="اسم الطالب"/>
                    <field name="id_number" string="رقم الهوية/الجواز"/>
                    <field name="age" string="العمر"/>
                    <field name="gender" string="الجنس"/>
                    <field name="student_grade" string="الصف"/>
                    <field name="headquarters_id" string="المقر"/>
                    <field name="department_id" string="القسم" optional="show"/>
                    <field name="club_id" string="النادي" optional="show"/>
                    <field name="term_id" string="الترم" optional="show"/>
                    <field name="nationality" string="الجنسية" optional="hide"/>
                    <field name="mother_name" string="اسم الأم" optional="hide"/>
                    <field name="father_name" string="اسم الأب" optional="hide"/>
                    <field name="registration_date" string="تاريخ التسجيل" widget="datetime" optional="hide"/>
                    <field name="state" string="الحالة" widget="badge"
                           decoration-success="state == 'approved'"
                           decoration-info="state == 'confirmed'"
                           decoration-warning="state == 'draft'"
                           decoration-danger="state == 'rejected'"/>
                </list>
            </field>
        </record>

        <!-- Registration Search View -->
        <record id="view_charity_registrations_search" model="ir.ui.view">
            <field name="name">charity.registrations.search</field>
            <field name="model">charity.registrations</field>
            <field name="arch" type="xml">
                <search string="البحث في التسجيلات">
                    <field name="full_name" string="اسم الطالب"/>
                    <field name="id_number" string="رقم الهوية/الجواز"/>
                    <field name="mother_name" string="اسم الأم"/>
                    <field name="father_name" string="اسم الأب"/>
                    <field name="student_grade" string="الصف"/>

                    <filter string="تسجيل نادي" name="club_reg" domain="[('registration_type', '=', 'club')]"/>
                    <filter string="حجز قسم" name="booking_reg" domain="[('registration_type', '=', 'booking')]"/>

                    <separator/>

                    <filter string="ذكور" name="male" domain="[('gender', '=', 'male')]"/>
                    <filter string="إناث" name="female" domain="[('gender', '=', 'female')]"/>

                    <separator/>

                    <filter string="هوية إماراتية" name="emirates_id" domain="[('id_type', '=', 'emirates_id')]"/>
                    <filter string="جواز سفر" name="passport" domain="[('id_type', '=', 'passport')]"/>

                    <separator/>

                    <filter string="مسودة" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="مؤكد" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                    <filter string="معتمد" name="approved" domain="[('state', '=', 'approved')]"/>
                    <filter string="مرفوض" name="rejected" domain="[('state', '=', 'rejected')]"/>
                    <filter string="ملغي" name="cancelled" domain="[('state', '=', 'cancelled')]"/>

                    <separator/>

                    <filter string="لديه متطلبات صحية" name="has_health" domain="[('has_health_requirements', '=', True)]"/>
                    <filter string="موافق على التصوير" name="photo_consent" domain="[('photo_consent', '=', True)]"/>

                    <separator/>

                    <filter string="مشترك سابق في رؤيتي" name="previous_roayati" domain="[('previous_roayati_member', '=', True)]"/>
                    <filter string="مشترك سابق في نادي عربي" name="previous_arabic" domain="[('previous_arabic_club', '=', True)]"/>

                    <group expand="0" string="تجميع حسب">
                        <filter string="نوع التسجيل" name="group_reg_type" context="{'group_by': 'registration_type'}"/>
                        <filter string="المقر" name="group_headquarters" context="{'group_by': 'headquarters_id'}"/>
                        <filter string="القسم" name="group_department" context="{'group_by': 'department_id'}"/>
                        <filter string="النادي" name="group_club" context="{'group_by': 'club_id'}"/>
                        <filter string="الترم" name="group_term" context="{'group_by': 'term_id'}"/>
                        <filter string="الجنس" name="group_gender" context="{'group_by': 'gender'}"/>
                        <filter string="الصف" name="group_grade" context="{'group_by': 'student_grade'}"/>
                        <filter string="الجنسية" name="group_nationality" context="{'group_by': 'nationality'}"/>
                        <filter string="نوع تعليم العربية" name="group_arabic_type" context="{'group_by': 'arabic_education_type'}"/>
                        <filter string="الحالة" name="group_state" context="{'group_by': 'state'}"/>
                        <filter string="تاريخ التسجيل" name="group_date" context="{'group_by': 'registration_date:month'}"/>
                    </group>

                    <searchpanel>
                        <field name="state" string="الحالة" enable_counters="1" icon="fa-tasks"/>
                        <field name="gender" string="الجنس" enable_counters="1" icon="fa-venus-mars"/>
                        <field name="nationality" string="الجنسية" enable_counters="1" icon="fa-flag"/>
                    </searchpanel>
                </search>
            </field>
        </record>

        <!-- Registration Kanban View -->
        <record id="view_charity_registrations_kanban" model="ir.ui.view">
            <field name="name">charity.registrations.kanban</field>
            <field name="model">charity.registrations</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" default_group_by="state">
                    <field name="full_name"/>
                    <field name="age"/>
                    <field name="gender"/>
                    <field name="student_grade"/>
                    <field name="state"/>
                    <field name="has_health_requirements"/>
                    <field name="photo_consent"/>
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_global_click">
                                <div class="oe_kanban_details">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="full_name"/>
                                            </strong>
                                            <div class="o_kanban_tags_section">
                                                <span t-if="record.gender.raw_value == 'male'" class="badge rounded-pill text-bg-info">
                                                    <i class="fa fa-mars"/> ذكر
                                                </span>
                                                <span t-if="record.gender.raw_value == 'female'" class="badge rounded-pill text-bg-danger">
                                                    <i class="fa fa-venus"/> أنثى
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="o_kanban_record_body">
                                        <div>
                                            <i class="fa fa-graduation-cap"/> الصف: <field name="student_grade"/>
                                        </div>
                                        <div>
                                            <i class="fa fa-birthday-cake"/> العمر: <field name="age"/> سنة
                                        </div>
                                        <div t-if="record.has_health_requirements.raw_value" class="text-danger">
                                            <i class="fa fa-medkit"/> لديه متطلبات صحية
                                        </div>
                                    </div>

                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'confirmed': 'info', 'approved': 'success', 'rejected': 'danger', 'cancelled': 'warning'}}"/>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <span t-if="record.photo_consent.raw_value" class="text-success">
                                                <i class="fa fa-camera" title="موافق على التصوير"/>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Registration Action -->
        <record id="action_charity_registrations" model="ir.actions.act_window">
            <field name="name">التسجيلات</field>
            <field name="res_model">charity.registrations</field>
            <field name="view_mode">kanban,list,form</field>
            <field name="search_view_id" ref="view_charity_registrations_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    إنشاء تسجيل جديد
                </p>
                <p>
                    يمكنك تسجيل الطلاب الجدد في النوادي والأقسام المختلفة
                </p>
            </field>
        </record>

    </data>
</odoo>