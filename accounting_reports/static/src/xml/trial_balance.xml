<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="accounting_reports.TrialBalance">
        <div class="o_action">
            <div class="ar-report">
                <!-- Loading -->
                <div t-if="state.isLoading" class="ar-loading">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>

                <div t-else="" class="ar-report-container">
                    <!-- Header -->
                    <div class="ar-header" style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);">
                        <h2 class="ar-header-title">
                            <i class="fa fa-balance-scale me-2"/>
                            Trial Balance
                        </h2>
                    </div>

                    <!-- Filters -->
                    <div class="ar-filters">
                        <!-- Date Range -->
                        <div class="ar-filter-row">
                            <span class="ar-filter-label">
                                <i class="fa fa-calendar"/>
                                Date From
                            </span>
                            <input type="date" 
                                   class="ar-date-input"
                                   t-att-value="state.dateFrom"
                                   t-on-change="onChangeDateFrom"/>
                            
                            <span class="ar-filter-label">To</span>
                            <input type="date" 
                                   class="ar-date-input"
                                   t-att-value="state.dateTo"
                                   t-on-change="onChangeDateTo"/>

                            <label class="ar-checkbox">
                                <input type="checkbox"
                                       t-att-checked="state.postedOnly"
                                       t-on-change="onChangePostedOnly"/>
                                <span>Posted Only</span>
                            </label>

                            <label class="ar-checkbox">
                                <input type="checkbox"
                                       t-att-checked="state.hideZero"
                                       t-on-change="onChangeHideZero"/>
                                <span>Hide Zero Balances</span>
                            </label>
                        </div>

                        <!-- Account Type Search Filter -->
                        <div class="ar-filter-row">
                            <span class="ar-filter-label">
                                <i class="fa fa-filter"/>
                                Account Types
                            </span>
                            <div class="type-search-container">
                                <!-- Selected Types Tags -->
                                <div class="selected-types" t-if="state.selectedAccountTypes.length">
                                    <t t-foreach="state.selectedAccountTypes" t-as="atype" t-key="atype.id">
                                        <span class="type-tag">
                                            <t t-esc="atype.name"/>
                                            <i class="fa fa-times" t-on-click="() => this.removeAccountType(atype.id)"/>
                                        </span>
                                    </t>
                                    <button class="clear-all-btn" t-on-click="clearAllAccountTypes" title="Clear All">
                                        <i class="fa fa-times-circle"/>
                                    </button>
                                </div>
                                
                                <!-- Search Input -->
                                <div class="type-search-wrapper">
                                    <input type="text" 
                                           class="type-search-input"
                                           placeholder="Search account types..."
                                           t-att-value="state.accountTypeSearch"
                                           t-on-input="onAccountTypeSearchInput"
                                           t-on-focus="onAccountTypeSearchFocus"
                                           t-on-blur="onAccountTypeSearchBlur"/>
                                    <i class="fa fa-search search-icon"/>
                                    
                                    <!-- Dropdown Results -->
                                    <div class="type-dropdown" t-if="state.showAccountTypeDropdown">
                                        <t t-foreach="state.filteredAccountTypes" t-as="atype" t-key="atype.id">
                                            <div class="type-dropdown-item" t-on-click="() => this.selectAccountType(atype)">
                                                <span class="type-name" t-esc="atype.name"/>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="ar-filter-row">
                            <button class="ar-btn ar-btn-primary" t-on-click="onRefresh" style="background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);">
                                <i class="fa fa-refresh"/> Refresh
                            </button>
                            <button class="ar-btn ar-btn-success" t-on-click="onExportExcel">
                                <i class="fa fa-file-excel-o"/> Export
                            </button>
                            <button class="ar-btn ar-btn-secondary" t-on-click="onPrint">
                                <i class="fa fa-print"/> Print
                            </button>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div class="tb-kpi-section">
                        <div class="tb-kpi-group">
                            <h4 class="tb-kpi-group-title">Opening Balance</h4>
                            <div class="tb-kpi-cards">
                                <div class="tb-kpi-card debit">
                                    <span class="tb-kpi-label">Debit</span>
                                    <span class="tb-kpi-value" t-esc="formatNumber(state.totalOpeningDebit)"/>
                                </div>
                                <div class="tb-kpi-card credit">
                                    <span class="tb-kpi-label">Credit</span>
                                    <span class="tb-kpi-value" t-esc="formatNumber(state.totalOpeningCredit)"/>
                                </div>
                            </div>
                        </div>
                        <div class="tb-kpi-group">
                            <h4 class="tb-kpi-group-title">Period Movement</h4>
                            <div class="tb-kpi-cards">
                                <div class="tb-kpi-card debit">
                                    <span class="tb-kpi-label">Debit</span>
                                    <span class="tb-kpi-value" t-esc="formatNumber(state.totalDebit)"/>
                                </div>
                                <div class="tb-kpi-card credit">
                                    <span class="tb-kpi-label">Credit</span>
                                    <span class="tb-kpi-value" t-esc="formatNumber(state.totalCredit)"/>
                                </div>
                            </div>
                        </div>
                        <div class="tb-kpi-group">
                            <h4 class="tb-kpi-group-title">Closing Balance</h4>
                            <div class="tb-kpi-cards">
                                <div class="tb-kpi-card debit">
                                    <span class="tb-kpi-label">Debit</span>
                                    <span class="tb-kpi-value" t-esc="formatNumber(state.totalClosingDebit)"/>
                                </div>
                                <div class="tb-kpi-card credit">
                                    <span class="tb-kpi-label">Credit</span>
                                    <span class="tb-kpi-value" t-esc="formatNumber(state.totalClosingCredit)"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Report Table -->
                    <div class="tb-table-container">
                        <table class="tb-table">
                            <thead>
                                <tr>
                                    <th rowspan="2" class="tb-col-code">Code</th>
                                    <th rowspan="2" class="tb-col-name">Account Name</th>
                                    <th rowspan="2" class="tb-col-type">Type</th>
                                    <th colspan="2" class="tb-col-group">Opening Balance</th>
                                    <th colspan="2" class="tb-col-group">Period Movement</th>
                                    <th colspan="2" class="tb-col-group">Closing Balance</th>
                                </tr>
                                <tr>
                                    <th class="tb-col-amount">Debit</th>
                                    <th class="tb-col-amount">Credit</th>
                                    <th class="tb-col-amount">Debit</th>
                                    <th class="tb-col-amount">Credit</th>
                                    <th class="tb-col-amount">Debit</th>
                                    <th class="tb-col-amount">Credit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Empty State -->
                                <tr t-if="!state.reportData.accounts || !state.reportData.accounts.length">
                                    <td colspan="9">
                                        <div class="tb-empty-state">
                                            <i class="fa fa-inbox"/>
                                            <h4>No Data Found</h4>
                                            <p>No accounts found for the selected filters.</p>
                                        </div>
                                    </td>
                                </tr>

                                <!-- Account Rows -->
                                <t t-foreach="state.reportData.accounts || []" t-as="account" t-key="account.id">
                                    <tr class="tb-row-account" t-on-click="() => this.openAccount(account.id)">
                                        <td class="tb-col-code">
                                            <span class="tb-account-code" t-esc="account.code"/>
                                        </td>
                                        <td class="tb-col-name">
                                            <span class="tb-account-name" t-esc="account.name"/>
                                        </td>
                                        <td class="tb-col-type">
                                            <span class="tb-type-badge" t-esc="account.account_type_name"/>
                                        </td>
                                        <!-- Opening -->
                                        <td class="tb-col-amount">
                                            <t t-if="account.opening_debit">
                                                <span class="tb-amount-debit" t-esc="formatNumber(account.opening_debit)"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <td class="tb-col-amount">
                                            <t t-if="account.opening_credit">
                                                <span class="tb-amount-credit" t-esc="formatNumber(account.opening_credit)"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <!-- Period -->
                                        <td class="tb-col-amount">
                                            <t t-if="account.debit">
                                                <span class="tb-amount-debit" t-esc="formatNumber(account.debit)"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <td class="tb-col-amount">
                                            <t t-if="account.credit">
                                                <span class="tb-amount-credit" t-esc="formatNumber(account.credit)"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <!-- Closing -->
                                        <td class="tb-col-amount">
                                            <t t-if="account.closing_debit">
                                                <span class="tb-amount-debit tb-closing" t-esc="formatNumber(account.closing_debit)"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                        <td class="tb-col-amount">
                                            <t t-if="account.closing_credit">
                                                <span class="tb-amount-credit tb-closing" t-esc="formatNumber(account.closing_credit)"/>
                                            </t>
                                            <t t-else="">-</t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>

                            <!-- Grand Total -->
                            <tfoot t-if="state.reportData.accounts and state.reportData.accounts.length">
                                <tr class="tb-row-total">
                                    <td colspan="3">
                                        <strong>ðŸ“Š TOTAL</strong>
                                    </td>
                                    <td class="tb-col-amount" t-esc="formatNumber(state.reportData.totals.opening_debit || 0)"/>
                                    <td class="tb-col-amount" t-esc="formatNumber(state.reportData.totals.opening_credit || 0)"/>
                                    <td class="tb-col-amount" t-esc="formatNumber(state.reportData.totals.debit || 0)"/>
                                    <td class="tb-col-amount" t-esc="formatNumber(state.reportData.totals.credit || 0)"/>
                                    <td class="tb-col-amount" t-esc="formatNumber(state.reportData.totals.closing_debit || 0)"/>
                                    <td class="tb-col-amount" t-esc="formatNumber(state.reportData.totals.closing_credit || 0)"/>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </t>

</templates>
