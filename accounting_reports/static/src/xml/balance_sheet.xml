<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="accounting_reports.BalanceSheet">
        <div class="o_action">
            <div class="ar-report">
                <div t-if="state.isLoading" class="ar-loading">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>

                <div t-else="" class="ar-report-container">
                    <!-- Header -->
                    <div class="ar-header" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);">
                        <h2 class="ar-header-title">
                            <i class="fa fa-balance-scale me-2"/>
                            Balance Sheet
                        </h2>
                        <div class="bs-header-date" t-if="state.reportData.as_of_date">
                            As of <span t-esc="state.reportData.as_of_date"/>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="ar-filters">
                        <div class="ar-filter-row">
                            <span class="ar-filter-label">
                                <i class="fa fa-calendar"/>
                                As of Date
                            </span>
                            <input type="date" 
                                   class="ar-date-input"
                                   t-att-value="state.asOfDate"
                                   t-on-change="onChangeAsOfDate"/>

                            <label class="ar-checkbox">
                                <input type="checkbox"
                                       t-att-checked="state.postedOnly"
                                       t-on-change="onChangePostedOnly"/>
                                <span>Posted Only</span>
                            </label>
                        </div>

                        <!-- Comparison Options -->
                        <div class="ar-filter-row">
                            <label class="ar-checkbox">
                                <input type="checkbox"
                                       t-att-checked="state.comparison"
                                       t-on-change="onChangeComparison"/>
                                <span>Compare with:</span>
                            </label>
                            <input type="date" 
                                   class="ar-date-input"
                                   t-att-value="state.comparisonDate"
                                   t-att-disabled="!state.comparison"
                                   t-on-change="onChangeComparisonDate"/>
                            <span class="bs-comp-label" t-if="state.comparison and state.reportData.comparison_date">
                                (<t t-esc="state.reportData.comparison_date"/>)
                            </span>
                        </div>

                        <!-- Quick Date Buttons -->
                        <div class="ar-filter-row">
                            <span class="ar-filter-label">Quick:</span>
                            <button class="ar-btn ar-btn-outline" t-on-click="() => this.setQuickDate('today')">Today</button>
                            <button class="ar-btn ar-btn-outline" t-on-click="() => this.setQuickDate('month_end')">Month End</button>
                            <button class="ar-btn ar-btn-outline" t-on-click="() => this.setQuickDate('quarter_end')">Quarter End</button>
                            <button class="ar-btn ar-btn-outline" t-on-click="() => this.setQuickDate('year_end')">Year End</button>
                            <button class="ar-btn ar-btn-outline" t-on-click="() => this.setQuickDate('last_year_end')">Last Year End</button>
                        </div>

                        <!-- Actions -->
                        <div class="ar-filter-row">
                            <button class="ar-btn ar-btn-primary" t-on-click="onRefresh" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);">
                                <i class="fa fa-refresh"/> Refresh
                            </button>
                            <button class="ar-btn ar-btn-success" t-on-click="onExportExcel">
                                <i class="fa fa-file-excel-o"/> Export
                            </button>
                            <button class="ar-btn ar-btn-secondary" t-on-click="onPrint">
                                <i class="fa fa-print"/> Print
                            </button>
                            <button class="ar-btn ar-btn-info" t-on-click="expandAll">
                                <i class="fa fa-expand"/> Expand All
                            </button>
                            <button class="ar-btn ar-btn-secondary" t-on-click="collapseAll">
                                <i class="fa fa-compress"/> Collapse
                            </button>
                        </div>
                    </div>

                    <!-- Balance Check Alert -->
                    <div t-if="!state.reportData.summary?.is_balanced" class="bs-balance-alert">
                        <i class="fa fa-exclamation-triangle me-2"/>
                        <strong>Warning:</strong> Balance Sheet is not balanced! 
                        Difference: <span t-esc="formatNumber(state.reportData.summary?.difference || 0)"/>
                    </div>

                    <!-- Summary Cards -->
                    <div class="bs-summary">
                        <div class="bs-summary-card assets">
                            <div class="bs-card-icon"><i class="fa fa-briefcase"/></div>
                            <div class="bs-card-content">
                                <span class="bs-card-label">Total Assets</span>
                                <span class="bs-card-value" t-esc="formatNumber(state.reportData.summary?.total_assets || 0)"/>
                                <span class="bs-card-change" t-if="state.comparison">
                                    vs <t t-esc="formatNumber(state.reportData.summary?.comp_total_assets || 0)"/>
                                </span>
                            </div>
                        </div>
                        <div class="bs-summary-card liabilities">
                            <div class="bs-card-icon"><i class="fa fa-credit-card"/></div>
                            <div class="bs-card-content">
                                <span class="bs-card-label">Total Liabilities</span>
                                <span class="bs-card-value" t-esc="formatNumber(state.reportData.summary?.total_liabilities || 0)"/>
                                <span class="bs-card-change" t-if="state.comparison">
                                    vs <t t-esc="formatNumber(state.reportData.summary?.comp_total_liabilities || 0)"/>
                                </span>
                            </div>
                        </div>
                        <div class="bs-summary-card equity">
                            <div class="bs-card-icon"><i class="fa fa-balance-scale"/></div>
                            <div class="bs-card-content">
                                <span class="bs-card-label">Total Equity</span>
                                <span class="bs-card-value" t-esc="formatNumber(state.reportData.summary?.total_equity || 0)"/>
                                <span class="bs-card-change" t-if="state.comparison">
                                    vs <t t-esc="formatNumber(state.reportData.summary?.comp_total_equity || 0)"/>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Main Table - Vertical Layout like Odoo -->
                    <div class="bs-table-container">
                        <table class="bs-table">
                            <thead>
                                <tr>
                                    <th class="bs-col-account">Account</th>
                                    <th class="bs-col-amount">Balance</th>
                                    <th class="bs-col-amount" t-if="state.comparison">Comparison</th>
                                    <th class="bs-col-change" t-if="state.comparison">Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ═══════════════════════════════════════════════════════════════
                                     ASSETS SECTION
                                     ═══════════════════════════════════════════════════════════════ -->
                                <tr class="bs-main-section assets">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <i class="fa fa-briefcase me-2"/>
                                        Assets
                                    </td>
                                </tr>

                                <!-- Current Assets -->
                                <tr class="bs-section-header section-assets" t-on-click="() => this.toggleSection('current_assets')">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <span class="bs-section-toggle">
                                            <i t-att-class="'fa ' + (isSectionExpanded('current_assets') ? 'fa-chevron-down' : 'fa-chevron-right')"/>
                                        </span>
                                        Current Assets
                                        <span class="bs-section-total" t-esc="formatNumber(state.reportData.sections?.current_assets?.total || 0)"/>
                                    </td>
                                </tr>
                                <t t-if="isSectionExpanded('current_assets')">
                                    <t t-foreach="state.reportData.sections?.current_assets?.accounts || []" t-as="account" t-key="account.id">
                                        <tr class="bs-account-row" t-on-click="() => this.openAccount(account.id)">
                                            <td class="bs-col-account">
                                                <span class="bs-account-indent"/>
                                                <span class="bs-account-name" t-esc="account.name"/>
                                            </td>
                                            <td t-att-class="'bs-col-amount ' + (account.balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-amount ' + (account.comp_balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.comp_balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(account.change)">
                                                <t t-esc="formatChange(account.change)"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                                <tr class="bs-section-subtotal">
                                    <td class="bs-col-account"><strong>Total Current Assets</strong></td>
                                    <td t-att-class="'bs-col-amount ' + ((state.reportData.sections?.current_assets?.total || 0) &lt; 0 ? 'negative' : '')" 
                                        t-esc="formatNumber(state.reportData.sections?.current_assets?.total || 0)"/>
                                    <td t-if="state.comparison" class="bs-col-amount" t-esc="formatNumber(state.reportData.sections?.current_assets?.comp_total || 0)"/>
                                    <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(state.reportData.sections?.current_assets?.change)">
                                        <t t-esc="formatChange(state.reportData.sections?.current_assets?.change || 0)"/>
                                    </td>
                                </tr>

                                <!-- Non-Current Assets -->
                                <tr class="bs-section-header section-assets" t-on-click="() => this.toggleSection('non_current_assets')">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <span class="bs-section-toggle">
                                            <i t-att-class="'fa ' + (isSectionExpanded('non_current_assets') ? 'fa-chevron-down' : 'fa-chevron-right')"/>
                                        </span>
                                        Non-current Assets
                                        <span class="bs-section-total" t-esc="formatNumber(state.reportData.sections?.non_current_assets?.total || 0)"/>
                                    </td>
                                </tr>
                                <t t-if="isSectionExpanded('non_current_assets')">
                                    <t t-foreach="state.reportData.sections?.non_current_assets?.accounts || []" t-as="account" t-key="account.id">
                                        <tr class="bs-account-row" t-on-click="() => this.openAccount(account.id)">
                                            <td class="bs-col-account">
                                                <span class="bs-account-indent"/>
                                                <span class="bs-account-name" t-esc="account.name"/>
                                            </td>
                                            <td t-att-class="'bs-col-amount ' + (account.balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-amount ' + (account.comp_balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.comp_balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(account.change)">
                                                <t t-esc="formatChange(account.change)"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>

                                <!-- Total Assets -->
                                <tr class="bs-total-row assets">
                                    <td class="bs-col-account"><strong>Total Assets</strong></td>
                                    <td t-att-class="'bs-col-amount ' + ((state.reportData.summary?.total_assets || 0) &lt; 0 ? 'negative' : '')" 
                                        t-esc="formatNumber(state.reportData.summary?.total_assets || 0)"/>
                                    <td t-if="state.comparison" class="bs-col-amount" t-esc="formatNumber(state.reportData.summary?.comp_total_assets || 0)"/>
                                    <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass((state.reportData.summary?.total_assets || 0) - (state.reportData.summary?.comp_total_assets || 0))">
                                        <t t-esc="formatChange((state.reportData.summary?.total_assets || 0) - (state.reportData.summary?.comp_total_assets || 0))"/>
                                    </td>
                                </tr>

                                <!-- Spacer -->
                                <tr class="bs-spacer"><td t-att-colspan="state.comparison ? 4 : 2"/></tr>

                                <!-- ═══════════════════════════════════════════════════════════════
                                     LIABILITIES SECTION
                                     ═══════════════════════════════════════════════════════════════ -->
                                <tr class="bs-main-section liabilities">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <i class="fa fa-credit-card me-2"/>
                                        Liabilities
                                    </td>
                                </tr>

                                <!-- Current Liabilities -->
                                <tr class="bs-section-header section-liabilities" t-on-click="() => this.toggleSection('current_liabilities')">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <span class="bs-section-toggle">
                                            <i t-att-class="'fa ' + (isSectionExpanded('current_liabilities') ? 'fa-chevron-down' : 'fa-chevron-right')"/>
                                        </span>
                                        Current liabilities
                                        <span class="bs-section-total" t-esc="formatNumber(state.reportData.sections?.current_liabilities?.total || 0)"/>
                                    </td>
                                </tr>
                                <t t-if="isSectionExpanded('current_liabilities')">
                                    <t t-foreach="state.reportData.sections?.current_liabilities?.accounts || []" t-as="account" t-key="account.id">
                                        <tr class="bs-account-row" t-on-click="() => this.openAccount(account.id)">
                                            <td class="bs-col-account">
                                                <span class="bs-account-indent"/>
                                                <span class="bs-account-name" t-esc="account.name"/>
                                            </td>
                                            <td t-att-class="'bs-col-amount ' + (account.balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-amount ' + (account.comp_balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.comp_balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(account.change)">
                                                <t t-esc="formatChange(account.change)"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>
                                <tr class="bs-section-subtotal">
                                    <td class="bs-col-account"><strong>Total Current liabilities</strong></td>
                                    <td t-att-class="'bs-col-amount ' + ((state.reportData.sections?.current_liabilities?.total || 0) &lt; 0 ? 'negative' : '')"
                                        t-esc="formatNumber(state.reportData.sections?.current_liabilities?.total || 0)"/>
                                    <td t-if="state.comparison" class="bs-col-amount" t-esc="formatNumber(state.reportData.sections?.current_liabilities?.comp_total || 0)"/>
                                    <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(state.reportData.sections?.current_liabilities?.change)">
                                        <t t-esc="formatChange(state.reportData.sections?.current_liabilities?.change || 0)"/>
                                    </td>
                                </tr>

                                <!-- Non-Current Liabilities -->
                                <tr class="bs-section-header section-liabilities" t-on-click="() => this.toggleSection('non_current_liabilities')">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <span class="bs-section-toggle">
                                            <i t-att-class="'fa ' + (isSectionExpanded('non_current_liabilities') ? 'fa-chevron-down' : 'fa-chevron-right')"/>
                                        </span>
                                        Non-current liabilities
                                        <span class="bs-section-total" t-esc="formatNumber(state.reportData.sections?.non_current_liabilities?.total || 0)"/>
                                    </td>
                                </tr>
                                <t t-if="isSectionExpanded('non_current_liabilities')">
                                    <t t-foreach="state.reportData.sections?.non_current_liabilities?.accounts || []" t-as="account" t-key="account.id">
                                        <tr class="bs-account-row" t-on-click="() => this.openAccount(account.id)">
                                            <td class="bs-col-account">
                                                <span class="bs-account-indent"/>
                                                <span class="bs-account-name" t-esc="account.name"/>
                                            </td>
                                            <td t-att-class="'bs-col-amount ' + (account.balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-amount ' + (account.comp_balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.comp_balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(account.change)">
                                                <t t-esc="formatChange(account.change)"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>

                                <!-- Total Liabilities -->
                                <tr class="bs-total-row liabilities">
                                    <td class="bs-col-account"><strong>Total Liabilities</strong></td>
                                    <td t-att-class="'bs-col-amount ' + ((state.reportData.summary?.total_liabilities || 0) &lt; 0 ? 'negative' : '')"
                                        t-esc="formatNumber(state.reportData.summary?.total_liabilities || 0)"/>
                                    <td t-if="state.comparison" class="bs-col-amount" t-esc="formatNumber(state.reportData.summary?.comp_total_liabilities || 0)"/>
                                    <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass((state.reportData.summary?.total_liabilities || 0) - (state.reportData.summary?.comp_total_liabilities || 0))">
                                        <t t-esc="formatChange((state.reportData.summary?.total_liabilities || 0) - (state.reportData.summary?.comp_total_liabilities || 0))"/>
                                    </td>
                                </tr>

                                <!-- Spacer -->
                                <tr class="bs-spacer"><td t-att-colspan="state.comparison ? 4 : 2"/></tr>

                                <!-- ═══════════════════════════════════════════════════════════════
                                     EQUITY SECTION
                                     ═══════════════════════════════════════════════════════════════ -->
                                <tr class="bs-main-section equity">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <i class="fa fa-balance-scale me-2"/>
                                        Equity
                                    </td>
                                </tr>

                                <!-- Equity Accounts -->
                                <tr class="bs-section-header section-equity" t-on-click="() => this.toggleSection('equity')">
                                    <td t-att-colspan="state.comparison ? 4 : 2">
                                        <span class="bs-section-toggle">
                                            <i t-att-class="'fa ' + (isSectionExpanded('equity') ? 'fa-chevron-down' : 'fa-chevron-right')"/>
                                        </span>
                                        Retained earnings
                                        <span class="bs-section-total" t-esc="formatNumber(state.reportData.sections?.equity?.total || 0)"/>
                                    </td>
                                </tr>
                                <t t-if="isSectionExpanded('equity')">
                                    <t t-foreach="state.reportData.sections?.equity?.accounts || []" t-as="account" t-key="account.id || account.code">
                                        <tr class="bs-account-row" t-on-click="() => this.openAccount(account.id)">
                                            <td class="bs-col-account">
                                                <span class="bs-account-indent"/>
                                                <span t-att-class="'bs-account-name ' + (account.account_type === 'retained_earnings' ? 'text-primary' : '')" 
                                                      t-esc="account.name"/>
                                            </td>
                                            <td t-att-class="'bs-col-amount ' + (account.balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-amount ' + (account.comp_balance &lt; 0 ? 'negative' : '')" t-esc="formatNumber(account.comp_balance)"/>
                                            <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass(account.change)">
                                                <t t-esc="formatChange(account.change)"/>
                                            </td>
                                        </tr>
                                    </t>
                                </t>

                                <!-- Total Equity -->
                                <tr class="bs-total-row equity">
                                    <td class="bs-col-account"><strong>Total Equity</strong></td>
                                    <td t-att-class="'bs-col-amount ' + ((state.reportData.summary?.total_equity || 0) &lt; 0 ? 'negative' : '')"
                                        t-esc="formatNumber(state.reportData.summary?.total_equity || 0)"/>
                                    <td t-if="state.comparison" class="bs-col-amount" t-esc="formatNumber(state.reportData.summary?.comp_total_equity || 0)"/>
                                    <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass((state.reportData.summary?.total_equity || 0) - (state.reportData.summary?.comp_total_equity || 0))">
                                        <t t-esc="formatChange((state.reportData.summary?.total_equity || 0) - (state.reportData.summary?.comp_total_equity || 0))"/>
                                    </td>
                                </tr>

                                <!-- Spacer -->
                                <tr class="bs-spacer"><td t-att-colspan="state.comparison ? 4 : 2"/></tr>

                                <!-- ═══════════════════════════════════════════════════════════════
                                     LIABILITIES + EQUITY
                                     ═══════════════════════════════════════════════════════════════ -->
                                <tr class="bs-grand-total">
                                    <td class="bs-col-account"><strong>Liabilities + Equity</strong></td>
                                    <td t-att-class="'bs-col-amount ' + ((state.reportData.summary?.total_liabilities_equity || 0) &lt; 0 ? 'negative' : '')"
                                        t-esc="formatNumber(state.reportData.summary?.total_liabilities_equity || 0)"/>
                                    <td t-if="state.comparison" class="bs-col-amount" t-esc="formatNumber(state.reportData.summary?.comp_total_liabilities_equity || 0)"/>
                                    <td t-if="state.comparison" t-att-class="'bs-col-change ' + getChangeClass((state.reportData.summary?.total_liabilities_equity || 0) - (state.reportData.summary?.comp_total_liabilities_equity || 0))">
                                        <t t-esc="formatChange((state.reportData.summary?.total_liabilities_equity || 0) - (state.reportData.summary?.comp_total_liabilities_equity || 0))"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Balance Equation Box -->
                    <div t-att-class="'bs-equation-box ' + (state.reportData.summary?.is_balanced ? 'balanced' : 'unbalanced')">
                        <div class="bs-equation">
                            <span class="bs-eq-item">
                                <span class="bs-eq-label">Assets</span>
                                <span class="bs-eq-value" t-esc="formatNumber(state.reportData.summary?.total_assets || 0)"/>
                            </span>
                            <span class="bs-eq-operator">=</span>
                            <span class="bs-eq-item">
                                <span class="bs-eq-label">Liabilities</span>
                                <span class="bs-eq-value" t-esc="formatNumber(state.reportData.summary?.total_liabilities || 0)"/>
                            </span>
                            <span class="bs-eq-operator">+</span>
                            <span class="bs-eq-item">
                                <span class="bs-eq-label">Equity</span>
                                <span class="bs-eq-value" t-esc="formatNumber(state.reportData.summary?.total_equity || 0)"/>
                            </span>
                        </div>
                        <div class="bs-balance-status">
                            <i t-att-class="'fa ' + (state.reportData.summary?.is_balanced ? 'fa-check-circle' : 'fa-times-circle')"/>
                            <span t-if="state.reportData.summary?.is_balanced">Balance Sheet is Balanced ✓</span>
                            <span t-else="">Not Balanced! Difference: <t t-esc="formatNumber(state.reportData.summary?.difference || 0)"/></span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </t>

</templates>
