<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="portal_my_home_menu_shipment" name="Portal layout : Shipments menu entry" inherit_id="portal.portal_breadcrumbs" priority="40">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'shipment' or shipment" t-attf-class="breadcrumb-item #{'active ' if not shipment else ''}">
                <a t-if="shipment" t-attf-href="/my/shipments?{{ keep_query() }}">Shipments</a>
                <t t-else="">Shipments</t>
            </li>
            <li t-if="shipment" class="breadcrumb-item active">
                <span t-esc="shipment.order_number"/>
            </li>
        </xpath>

    </template>

    <!-- Add Shipments Counter to Portal Home -->
    <template id="portal_my_home_shipment" name="Show Shipments" customize_show="True" inherit_id="portal.portal_my_home" priority="40">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/shipping_management_system/static/description/icon.png'"/>
                <t t-set="title">Shipments</t>
                <t t-set="text">Track and manage your shipments</t>
                <t t-set="url" t-value="'/my/shipments'"/>
                <t t-set="placeholder_count" t-value="'shipment_count'"/>
            </t>
        </xpath>
    </template>


    <template id="portal_my_shipments" name="My Shipments">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="False"/>

            <!-- Modern Header Section -->
            <div class="shipments-header-section">
                <div class="header-pattern"></div>
                <div class="container">
                    <div class="header-content-wrapper">
                        <div class="header-icon-animated">
                            <i class="fa fa-truck"></i>
                        </div>
                        <h1 class="page-title">شحناتي</h1>
                        <p class="page-subtitle">إدارة وتتبع جميع شحناتك في مكان واحد</p>
                    </div>
                </div>
            </div>

            <!-- Search Bar Enhanced -->
            <div class="container">
                <div class="search-section">
                    <t t-call="portal.portal_searchbar">
                        <t t-set="title">البحث في الشحنات</t>
                    </t>
                </div>
            </div>

            <!-- Empty State -->
            <t t-if="not shipments">
                <div class="container">
                    <div class="empty-state-container">
                        <div class="empty-illustration">
                            <i class="fa fa-box-open"></i>
                        </div>
                        <h3>لا توجد شحنات</h3>
                        <p>لم تقم بإنشاء أي شحنات حتى الآن</p>
                        <a href="/shipment" class="btn-create-shipment">
                            <i class="fas fa-plus-circle"></i>
                            إنشاء شحنة جديدة
                        </a>
                    </div>
                </div>
            </t>

            <!-- Shipments Table -->
            <t t-if="shipments">
                <div class="container">
                    <!-- Stats Cards -->
                    <div class="stats-row">
                        <div class="stat-card-mini draft">
                            <div class="stat-icon">
                                <i class="fa fa-file"></i>
                            </div>
                            <div class="stat-info">
                                <h3><t t-out="len(shipments.filtered(lambda s: s.state == 'draft'))"/></h3>
                                <p>مسودة</p>
                            </div>
                        </div>
                        <div class="stat-card-mini transit">
                            <div class="stat-icon">
                                <i class="fa fa-truck"></i>
                            </div>
                            <div class="stat-info">
                                <h3><t t-out="len(shipments.filtered(lambda s: s.state in ['picked', 'in_transit', 'out_for_delivery']))"/></h3>
                                <p>في الطريق</p>
                            </div>
                        </div>
                        <div class="stat-card-mini delivered">
                            <div class="stat-icon">
                                <i class="fa fa-check-circle"></i>
                            </div>
                            <div class="stat-info">
                                <h3><t t-out="len(shipments.filtered(lambda s: s.state == 'delivered'))"/></h3>
                                <p>تم التسليم</p>
                            </div>
                        </div>
                        <div class="stat-card-mini returned">
                            <div class="stat-icon">
                                <i class="fa fa-undo"></i>
                            </div>
                            <div class="stat-info">
                                <h3><t t-out="len(shipments.filtered(lambda s: s.state == 'returned'))"/></h3>
                                <p>مرتجع</p>
                            </div>
                        </div>
                    </div>

                    <!-- Modern Table -->
                    <div class="shipments-table-container">
                        <table class="shipments-table">
                            <thead>
                                <tr>
                                    <th>رقم الطلب</th>
                                    <th>رقم التتبع</th>
                                    <th class="d-none d-md-table-cell">التاريخ</th>
                                    <th class="d-none d-md-table-cell">المستلم</th>
                                    <th class="d-none d-md-table-cell">المدينة</th>
                                    <th>الحالة</th>
                                    <th class="text-center">المبلغ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="shipments" t-as="shipment">
                                    <tr class="shipment-row">
                                        <td>
                                            <a t-attf-href="/my/shipment/#{shipment.id}" class="order-link">
                                                <div class="order-number">
                                                    <i class="fa fa-file"></i>
                                                    <span><t t-out="shipment.order_number"/></span>
                                                </div>
                                            </a>
                                        </td>
                                        <td>
                                            <t t-if="shipment.tracking_number">
                                                <span class="tracking-badge">
                                                    <i class="fa fa-barcode"></i>
                                                    <t t-out="shipment.tracking_number"/>
                                                </span>
                                            </t>
                                            <t t-else="">
                                                <span class="no-data">-</span>
                                            </t>
                                        </td>
                                        <td class="d-none d-md-table-cell">
                                            <span class="date-badge">
                                                <t t-out="shipment.create_date" t-options='{"widget": "date"}'/>
                                            </span>
                                        </td>
                                        <td class="d-none d-md-table-cell">
                                            <div class="recipient-info">
                                                <i class="fa fa-user"></i>
                                                <span><t t-out="shipment.recipient_name"/></span>
                                            </div>
                                        </td>
                                        <td class="d-none d-md-table-cell">
                                            <div class="city-info">
                                                <i class="fas fa-map-marker-alt"></i>
                                                <span><t t-out="shipment.recipient_city"/></span>
                                            </div>
                                        </td>
                                        <td>
                                            <t t-if="shipment.state == 'draft'">
                                                <span class="status-badge draft">
                                                    <i class="fa fa-files-o"></i>
                                                    مسودة
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'confirmed'">
                                                <span class="status-badge confirmed">
                                                    <i class="fa fa-check"></i>
                                                    مؤكدة
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'picked'">
                                                <span class="status-badge picked">
                                                    <i class="fa fa-dropbox"></i>
                                                    تم الاستلام
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'in_transit'">
                                                <span class="status-badge transit">
                                                    <i class="fa fa-truck"></i>
                                                    في الطريق
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'out_for_delivery'">
                                                <span class="status-badge delivery">
                                                    <i class="fa fa-long-arrow-left"></i>
                                                    خارج للتسليم
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'delivered'">
                                                <span class="status-badge delivered">
                                                    <i class="fa fa-check-circle"></i>
                                                    تم التسليم
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'returned'">
                                                <span class="status-badge returned">
                                                    <i class="fa fa-undo"></i>
                                                    مرتجع
                                                </span>
                                            </t>
                                            <t t-elif="shipment.state == 'cancelled'">
                                                <span class="status-badge cancelled">
                                                    <i class="fa fa-times-circle"></i>
                                                    ملغاة
                                                </span>
                                            </t>
                                        </td>
                                        <td class="text-center">
                                            <div class="amount-badge">
                                                <strong><t t-out="shipment.final_customer_price"/></strong>
                                                <span class="currency">جنيه</span>
                                            </div>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </t>

            <!-- Custom Styles -->
            <style>
                /* Header Section */
                .shipments-header-section {
                    background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
                    padding: 60px 0 80px;
                    position: relative;
                    overflow: hidden;
                    margin-top: -20px;
                }

                .header-pattern {
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    opacity: 0.1;
                    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.3'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
                }

                .header-content-wrapper {
                    position: relative;
                    text-align: center;
                    z-index: 1;
                }

                .header-icon-animated {
                    width: 80px;
                    height: 80px;
                    margin: 0 auto 20px;
                    background: rgba(255,255,255,0.2);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: float 3s ease-in-out infinite;
                }

                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }

                .header-icon-animated i {
                    font-size: 36px;
                    color: white;
                }

                .page-title {
                    color: white;
                    font-size: 2.5rem;
                    font-weight: 800;
                    margin-bottom: 10px;
                }

                .page-subtitle {
                    color: rgba(255,255,255,0.95);
                    font-size: 1.1rem;
                }

                /* Search Section */
                .search-section {
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    margin: -40px 0 30px;
                    position: relative;
                    z-index: 10;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }

                /* Stats Row */
                .stats-row {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px;
                    margin-bottom: 30px;
                }

                .stat-card-mini {
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    transition: all 0.3s ease;
                }

                .stat-card-mini:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
                }

                .stat-card-mini .stat-icon {
                    width: 50px;
                    height: 50px;
                    border-radius: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 24px;
                    color: white;
                }

                .stat-card-mini.draft .stat-icon {
                    background: linear-gradient(135deg, #3498db, #2980b9);
                }

                .stat-card-mini.transit .stat-icon {
                    background: linear-gradient(135deg, #f39c12, #e67e22);
                }

                .stat-card-mini.delivered .stat-icon {
                    background: linear-gradient(135deg, #27ae60, #229954);
                }

                .stat-card-mini.returned .stat-icon {
                    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
                }

                .stat-info h3 {
                    font-size: 1.8rem;
                    font-weight: 800;
                    color: #2c3e50;
                    margin: 0;
                }

                .stat-info p {
                    color: #7f8c8d;
                    margin: 0;
                    font-weight: 600;
                }

                /* Table Container */
                .shipments-table-container {
                    background: white;
                    border-radius: 20px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                }

                .shipments-table {
                    width: 100%;
                    border-collapse: collapse;
                }

                .shipments-table thead {
                    background: linear-gradient(135deg, #004E7C, #0066A6);
                }

                .shipments-table thead th {
                    color: white;
                    padding: 18px 20px;
                    font-weight: 600;
                    text-align: right;
                    border: none;
                }

                .shipments-table tbody tr {
                    border-bottom: 1px solid #f0f3f6;
                    transition: all 0.3s ease;
                }

                .shipments-table tbody tr:hover {
                    background: rgba(255, 107, 53, 0.05);
                }

                .shipments-table tbody td {
                    padding: 20px;
                    vertical-align: middle;
                }

                /* Order Link */
                .order-link {
                    text-decoration: none;
                }

                .order-number {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    color: #FF6B35;
                    font-weight: 700;
                    transition: all 0.3s ease;
                }

                .order-number:hover {
                    color: #E85A2C;
                    transform: translateX(-5px);
                }

                .order-number i {
                    font-size: 18px;
                }

                /* Tracking Badge */
                .tracking-badge {
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                    color: #FF6B35;
                    padding: 6px 12px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    font-weight: 600;
                    display: inline-flex;
                    align-items: center;
                    gap: 6px;
                }

                /* Date Badge */
                .date-badge {
                    background: #f8f9fa;
                    padding: 6px 12px;
                    border-radius: 8px;
                    font-weight: 600;
                    color: #2c3e50;
                }

                /* Recipient &amp; City Info */
                .recipient-info,
                .city-info {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    color: #2c3e50;
                }

                .recipient-info i,
                .city-info i {
                    color: #7f8c8d;
                    font-size: 14px;
                }

                /* Status Badges */
                .status-badge {
                    padding: 8px 14px;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.9rem;
                    display: inline-flex;
                    align-items: center;
                    gap: 6px;
                }

                .status-badge.draft {
                    background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
                    color: #3498db;
                }

                .status-badge.confirmed {
                    background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
                    color: #9b59b6;
                }

                .status-badge.picked {
                    background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(230, 126, 34, 0.1));
                    color: #f39c12;
                }

                .status-badge.transit {
                    background: linear-gradient(135deg, rgba(230, 126, 34, 0.1), rgba(211, 84, 0, 0.1));
                    color: #e67e22;
                }

                .status-badge.delivery {
                    background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
                    color: #3498db;
                }

                .status-badge.delivered {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(34, 153, 84, 0.1));
                    color: #27ae60;
                }

                .status-badge.returned {
                    background: linear-gradient(135deg, rgba(149, 165, 166, 0.1), rgba(127, 140, 141, 0.1));
                    color: #7f8c8d;
                }

                .status-badge.cancelled {
                    background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1));
                    color: #e74c3c;
                }

                /* Amount Badge */
                .amount-badge {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(34, 153, 84, 0.1));
                    padding: 8px 16px;
                    border-radius: 12px;
                    display: inline-block;
                }

                .amount-badge strong {
                    color: #27ae60;
                    font-size: 1.1rem;
                }

                .currency {
                    color: #7f8c8d;
                    font-size: 0.9rem;
                    margin-right: 4px;
                }

                /* Empty State */
                .empty-state-container {
                    text-align: center;
                    padding: 80px 20px;
                    background: white;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                }

                .empty-illustration {
                    width: 120px;
                    height: 120px;
                    margin: 0 auto 30px;
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: pulse 2s infinite;
                }

                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }

                .empty-illustration i {
                    font-size: 60px;
                    color: #FF6B35;
                }

                .empty-state-container h3 {
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: #2c3e50;
                    margin-bottom: 10px;
                }

                .empty-state-container p {
                    color: #7f8c8d;
                    font-size: 1.1rem;
                    margin-bottom: 30px;
                }

                .btn-create-shipment {
                    background: linear-gradient(135deg, #FF6B35, #F7931E);
                    color: white;
                    padding: 15px 35px;
                    border-radius: 30px;
                    text-decoration: none;
                    font-weight: 700;
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                    transition: all 0.3s ease;
                    box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
                }

                .btn-create-shipment:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 15px 40px rgba(255, 107, 53, 0.4);
                    color: white;
                    text-decoration: none;
                }

                .no-data {
                    color: #bdc3c7;
                    font-style: italic;
                }

                /* Responsive */
                @media (max-width: 768px) {
                    .page-title {
                        font-size: 2rem;
                    }

                    .stats-row {
                        grid-template-columns: repeat(2, 1fr);
                    }

                    .shipments-table {
                        font-size: 0.9rem;
                    }

                    .shipments-table thead th,
                    .shipments-table tbody td {
                        padding: 12px 10px;
                    }
                }

                /* RTL Support */
                body[dir="rtl"] .shipments-table thead th,
                body[dir="rtl"] .shipments-table tbody td {
                    text-align: right;
                }

                body[dir="rtl"] .order-number:hover {
                    transform: translateX(5px);
                }

                body[dir="rtl"] .text-center {
                    text-align: center !important;
                }
            </style>
        </t>
    </template>

    <!-- ============================================ -->
    <!-- Shipment Detail View -->
    <!-- ============================================ -->



    <template id="portal_my_shipment_detail" name="My Shipment Detail">
        <t t-call="portal.portal_layout">
            <!-- Admin Edit Mode -->
            <t t-set="o_portal_fullwidth_alert" groups="sales_team.group_sale_salesman">
                <t t-call="portal.portal_back_in_edit_mode">
                    <t t-set="backend_url" t-value="'/web#model=shipment.order&amp;id=%s&amp;view_type=form' % (shipment.id)"/>
                </t>
            </t>

            <!-- Modern Header -->
            <div class="shipment-detail-hero">
                <div class="hero-background"></div>
                <div class="container">
                    <div class="hero-content">
                        <div class="row align-items-center">
                            <div class="col-lg-8">
                                <div class="shipment-title-section">
                                    <h1 class="shipment-title">
                                        <i class="fas fa-truck"></i>
                                        شحنة رقم: <span class="order-number"><t t-out="shipment.order_number"/></span>
                                    </h1>
                                    <div class="shipment-meta">
                                        <span class="meta-item">
                                            <i class="fas fa-calendar-alt"></i>
                                            تاريخ الإنشاء: <t t-out="shipment.create_date" t-options='{"widget": "date"}'/>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 text-lg-right">
                                <t t-if="shipment.state == 'draft'">
                                    <div class="status-badge-large draft">
                                        <i class="fas fa-file-alt"></i>
                                        <span>مسودة</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'confirmed'">
                                    <div class="status-badge-large confirmed">
                                        <i class="fas fa-check"></i>
                                        <span>مؤكدة</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'picked'">
                                    <div class="status-badge-large picked">
                                        <i class="fas fa-box"></i>
                                        <span>تم الاستلام</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'in_transit'">
                                    <div class="status-badge-large transit">
                                        <i class="fas fa-shipping-fast"></i>
                                        <span>في الطريق</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'out_for_delivery'">
                                    <div class="status-badge-large delivery">
                                        <i class="fas fa-route"></i>
                                        <span>خارج للتسليم</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'delivered'">
                                    <div class="status-badge-large delivered">
                                        <i class="fas fa-check-circle"></i>
                                        <span>تم التسليم</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'returned'">
                                    <div class="status-badge-large returned">
                                        <i class="fas fa-undo"></i>
                                        <span>مرتجع</span>
                                    </div>
                                </t>
                                <t t-elif="shipment.state == 'cancelled'">
                                    <div class="status-badge-large cancelled">
                                        <i class="fas fa-times-circle"></i>
                                        <span>ملغاة</span>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tracking Bar -->
            <t t-if="shipment.tracking_number">
                <div class="tracking-bar">
                    <div class="container">
                        <div class="tracking-content">
                            <div class="tracking-info">
                                <i class="fas fa-barcode"></i>
                                <span class="tracking-label">رقم التتبع:</span>
                                <span class="tracking-number"><t t-esc="shipment.tracking_number"/></span>
                            </div>
                            <a t-att-href="'/shipment/track?tracking=%s' % shipment.tracking_number"
                               class="btn-track">
                                <i class="fas fa-search"></i>
                                تتبع الشحنة
                            </a>
                        </div>
                    </div>
                </div>
            </t>

            <div class="container shipment-detail-content">
                <!-- Info Cards Row -->
                <div class="row mb-4">
                    <!-- Sender Card -->
                    <div class="col-lg-6 mb-4">
                        <div class="info-card sender-card">
                            <div class="card-header-modern">
                                <div class="header-icon sender">
                                    <i class="fas fa-user"></i>
                                </div>
                                <h3 class="card-title">معلومات المرسل</h3>
                            </div>
                            <div class="card-body-modern">
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-user-tag"></i> الاسم:
                                    </span>
                                    <span class="info-value"><t t-out="shipment.sender_name"/></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-phone"></i> الهاتف:
                                    </span>
                                    <span class="info-value" dir="ltr"><t t-out="shipment.sender_phone"/></span>
                                </div>
                                <t t-if="shipment.sender_whatsapp">
                                    <div class="info-row">
                                        <span class="info-label">
                                            <i class="fab fa-whatsapp"></i> واتساب:
                                        </span>
                                        <span class="info-value" dir="ltr"><t t-out="shipment.sender_whatsapp"/></span>
                                    </div>
                                </t>
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-map-marker-alt"></i> العنوان:
                                    </span>
                                    <span class="info-value"><t t-out="shipment.sender_address"/></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-city"></i> المدينة:
                                    </span>
                                    <span class="info-value"><t t-out="shipment.sender_city"/></span>
                                </div>
                                <t t-if="shipment.sender_pickup_notes">
                                    <div class="notes-section">
                                        <div class="notes-label">
                                            <i class="fas fa-sticky-note"></i> ملاحظات الاستلام:
                                        </div>
                                        <div class="notes-content">
                                            <t t-out="shipment.sender_pickup_notes"/>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>

                    <!-- Recipient Card -->
                    <div class="col-lg-6 mb-4">
                        <div class="info-card recipient-card">
                            <div class="card-header-modern">
                                <div class="header-icon recipient">
                                    <i class="fas fa-map-marked-alt"></i>
                                </div>
                                <h3 class="card-title">معلومات المستلم</h3>
                            </div>
                            <div class="card-body-modern">
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-user-tag"></i> الاسم:
                                    </span>
                                    <span class="info-value"><t t-esc="shipment.recipient_name"/></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-phone"></i> الهاتف:
                                    </span>
                                    <span class="info-value" dir="ltr"><t t-esc="shipment.recipient_phone"/></span>
                                </div>
                                <t t-if="shipment.recipient_mobile">
                                    <div class="info-row">
                                        <span class="info-label">
                                            <i class="fas fa-mobile-alt"></i> هاتف بديل:
                                        </span>
                                        <span class="info-value" dir="ltr"><t t-esc="shipment.recipient_mobile"/></span>
                                    </div>
                                </t>
                                <t t-if="shipment.recipient_whatsapp">
                                    <div class="info-row">
                                        <span class="info-label">
                                            <i class="fab fa-whatsapp"></i> واتساب:
                                        </span>
                                        <span class="info-value" dir="ltr"><t t-esc="shipment.recipient_whatsapp"/></span>
                                    </div>
                                </t>
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-map-marker-alt"></i> العنوان:
                                    </span>
                                    <span class="info-value"><t t-esc="shipment.recipient_address"/></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">
                                        <i class="fas fa-city"></i> المدينة:
                                    </span>
                                    <span class="info-value"><t t-esc="shipment.recipient_city"/></span>
                                </div>
                                <t t-if="shipment.recipient_delivery_notes">
                                    <div class="notes-section">
                                        <div class="notes-label">
                                            <i class="fas fa-sticky-note"></i> ملاحظات التسليم:
                                        </div>
                                        <div class="notes-content">
                                            <t t-esc="shipment.recipient_delivery_notes"/>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div class="products-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            <i class="fas fa-boxes"></i>
                            المنتجات
                            <span class="items-count">(<t t-esc="len(shipment.shipment_line_ids)"/> عنصر)</span>
                        </h3>
                    </div>
                    <div class="products-table-wrapper">
                        <table class="products-table-modern">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>المنتج</th>
                                    <th>الفئة</th>
                                    <th>العلامة التجارية</th>
                                    <th class="text-center">الكمية</th>
                                    <th class="text-right">الوزن</th>
                                    <th class="text-right">القيمة</th>
                                    <th class="text-center">خاص</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="shipment.shipment_line_ids" t-as="line">
                                    <tr>
                                        <td class="row-number"><t t-out="line_index + 1"/></td>
                                        <td class="product-name">
                                            <strong><t t-out="line.product_name"/></strong>
                                        </td>
                                        <td>
                                            <t t-if="line.category_id">
                                                <span class="category-badge">
                                                    <t t-out="line.category_id.name"/>
                                                </span>
                                            </t>
                                        </td>
                                        <td>
                                            <t t-if="line.brand_id">
                                                <t t-out="line.brand_id.name"/>
                                            </t>
                                        </td>
                                        <td class="text-center">
                                            <span class="qty-badge"><t t-out="line.quantity"/></span>
                                        </td>
                                        <td class="text-right"><t t-out="line.weight"/> كجم</td>
                                        <td class="text-right amount"><t t-out="line.product_value"/> جنيه</td>
                                        <td class="text-center">
                                            <t t-if="line.fragile">
                                                <span class="special-badge fragile" title="قابل للكسر">
                                                    <i class="fas fa-glass-martini"></i>
                                                </span>
                                            </t>
                                            <t t-if="line.dangerous_goods">
                                                <span class="special-badge danger" title="بضائع خطرة">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                </span>
                                            </t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="totals-label">الإجماليات:</td>
                                    <td class="text-center">
                                        <strong class="total-qty">
                                            <t t-esc="sum(shipment.shipment_line_ids.mapped('quantity'))"/>
                                        </strong>
                                    </td>
                                    <td class="text-right">
                                        <strong><t t-esc="shipment.total_weight"/> كجم</strong>
                                    </td>
                                    <td class="text-right">
                                        <strong class="total-amount"><t t-esc="shipment.total_value"/> جنيه</strong>
                                    </td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <!-- Details Grid -->
                <div class="row mt-4">
                    <!-- Shipment Info -->
                    <div class="col-lg-6 mb-4">
                        <div class="detail-card">
                            <div class="detail-header">
                                <i class="fas fa-info-circle"></i>
                                <h4>تفاصيل الشحنة</h4>
                            </div>
                            <div class="detail-body">
                                <div class="detail-item">
                                    <span class="detail-label">النوع:</span>
                                    <span class="detail-value">
                                        <t t-esc="dict(shipment._fields['shipment_type'].selection).get(shipment.shipment_type)"/>
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">عدد الطرود:</span>
                                    <span class="detail-value"><t t-esc="shipment.package_count"/></span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">طريقة الدفع:</span>
                                    <span class="detail-value">
                                        <t t-if="shipment.payment_method == 'prepaid'">
                                            <span class="payment-badge prepaid">مدفوع مقدماً</span>
                                        </t>
                                        <t t-elif="shipment.payment_method == 'cod'">
                                            <span class="payment-badge cod">
                                                الدفع عند الاستلام
                                                (<t t-esc="shipment.cod_amount"/> جنيه)
                                            </span>
                                        </t>
                                        <t t-else="">
                                            <t t-esc="shipment.payment_method"/>
                                        </t>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="col-lg-6 mb-4">
                        <div class="detail-card">
                            <div class="detail-header">
                                <i class="fas fa-clock"></i>
                                <h4>الجدول الزمني</h4>
                            </div>
                            <div class="detail-body">
                                <div class="timeline-item">
                                    <div class="timeline-icon">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <span class="timeline-label">تاريخ الإنشاء:</span>
                                        <span class="timeline-date">
                                            <t t-esc="shipment.create_date" t-options='{"widget": "datetime"}'/>
                                        </span>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-icon">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <div class="timeline-content">
                                        <span class="timeline-label">تاريخ الاستلام:</span>
                                        <span class="timeline-date">
                                            <t t-esc="shipment.pickup_date" t-options='{"widget": "datetime"}'/>
                                        </span>
                                    </div>
                                </div>
                                <t t-if="shipment.expected_delivery">
                                    <div class="timeline-item">
                                        <div class="timeline-icon">
                                            <i class="fas fa-calendar-check"></i>
                                        </div>
                                        <div class="timeline-content">
                                            <span class="timeline-label">التسليم المتوقع:</span>
                                            <span class="timeline-date">
                                                <t t-esc="shipment.expected_delivery" t-options='{"widget": "datetime"}'/>
                                            </span>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="shipment.actual_delivery">
                                    <div class="timeline-item completed">
                                        <div class="timeline-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="timeline-content">
                                            <span class="timeline-label">التسليم الفعلي:</span>
                                            <span class="timeline-date success">
                                                <t t-esc="shipment.actual_delivery" t-options='{"widget": "datetime"}'/>
                                            </span>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pricing Section -->
                <div class="pricing-section">
                    <div class="section-header">
                        <h3 class="section-title">
                            <i class="fas fa-calculator"></i>
                            تفاصيل التسعير
                        </h3>
                    </div>
                    <div class="pricing-content">
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="invoice-status">
                                    <h5>حالة الفاتورة</h5>
                                    <t t-if="shipment.invoice_ids">
                                        <t t-foreach="shipment.invoice_ids" t-as="inv">
                                            <t t-if="inv.state == 'posted'">
                                                <div class="status-pill confirmed">
                                                    <i class="fas fa-check-circle"></i>
                                                    فاتورة مؤكدة - <t t-esc="inv.name"/>
                                                </div>
                                            </t>
                                            <t t-elif="inv.state == 'draft'">
                                                <div class="status-pill draft">
                                                    <i class="fas fa-clock"></i>
                                                    فاتورة مسودة
                                                </div>
                                            </t>
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <div class="status-pill pending">
                                            <i class="fas fa-hourglass-half"></i>
                                            لم يتم إنشاء فاتورة بعد
                                        </div>
                                    </t>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="price-breakdown">
                                    <h5>تفاصيل المبلغ</h5>
                                    <t t-if="shipment.invoice_ids.filtered(lambda i: i.state == 'posted')">
                                        <div class="price-item total">
                                            <span class="price-label">المبلغ الإجمالي:</span>
                                            <span class="price-value">
                                                <t t-esc="shipment.calculated_customer_price or shipment.final_customer_price or 0"/> جنيه
                                            </span>
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div class="price-item estimated">
                                            <span class="price-label">المبلغ التقديري:</span>
                                            <span class="price-value">
                                                <t t-esc="shipment.final_customer_price or 0"/> جنيه
                                            </span>
                                        </div>
                                    </t>
                                    <t t-if="shipment.payment_method == 'cod' and shipment.cod_amount">
                                        <div class="cod-notice">
                                            <i class="fas fa-money-bill-wave"></i>
                                            مبلغ الدفع عند الاستلام: <strong><t t-esc="shipment.cod_amount"/> جنيه</strong>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notes Section -->
                <t t-if="shipment.notes">
                    <div class="notes-card">
                        <div class="notes-header">
                            <i class="fas fa-comment-alt"></i>
                            <h4>ملاحظات إضافية</h4>
                        </div>
                        <div class="notes-body">
                            <t t-esc="shipment.notes"/>
                        </div>
                    </div>
                </t>

                <!-- Action Buttons -->
                <div class="action-buttons-section">
                    <t t-if="shipment.tracking_number">
                        <a t-att-href="'/shipment/track?tracking=%s' % shipment.tracking_number"
                           class="action-btn primary">
                            <i class="fas fa-search"></i>
                            تتبع الشحنة
                        </a>
                    </t>
                    <a href="/shipment" class="action-btn success">
                        <i class="fas fa-plus"></i>
                        شحنة جديدة
                    </a>
                    <a href="/my/shipments" class="action-btn secondary">
                        <i class="fas fa-arrow-right"></i>
                        العودة للقائمة
                    </a>
                </div>
            </div>

            <!-- Enhanced Styles -->
            <style>
                /* Hero Section */
                .shipment-detail-hero {
                    background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
                    padding: 60px 0 80px;
                    position: relative;
                    overflow: hidden;
                    margin-top: -20px;
                }

                .hero-background {
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    opacity: 0.1;
                    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.3'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
                }

                .hero-content {
                    position: relative;
                    z-index: 1;
                }

                .shipment-title {
                    color: white;
                    font-size: 2.5rem;
                    font-weight: 800;
                    margin-bottom: 15px;
                }

                .order-number {
                    background: rgba(255,255,255,0.2);
                    padding: 5px 15px;
                    border-radius: 10px;
                }

                .shipment-meta {
                    color: rgba(255,255,255,0.95);
                    font-size: 1.1rem;
                }

                .meta-item {
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                }

                /* Status Badge Large */
                .status-badge-large {
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                    padding: 15px 30px;
                    border-radius: 50px;
                    font-size: 1.2rem;
                    font-weight: 700;
                    color: white;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                }

                .status-badge-large.draft { background: linear-gradient(135deg, #3498db, #2980b9); }
                .status-badge-large.confirmed { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
                .status-badge-large.picked { background: linear-gradient(135deg, #f39c12, #e67e22); }
                .status-badge-large.transit { background: linear-gradient(135deg, #e67e22, #d35400); }
                .status-badge-large.delivery { background: linear-gradient(135deg, #3498db, #2980b9); }
                .status-badge-large.delivered { background: linear-gradient(135deg, #27ae60, #229954); }
                .status-badge-large.returned { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }
                .status-badge-large.cancelled { background: linear-gradient(135deg, #e74c3c, #c0392b); }

                /* Tracking Bar */
                .tracking-bar {
                    background: white;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                    padding: 20px 0;
                    margin-top: -40px;
                    position: relative;
                    z-index: 10;
                    border-radius: 15px;
                    margin-bottom: 30px;
                }

                .tracking-content {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    flex-wrap: wrap;
                    gap: 20px;
                }

                .tracking-info {
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    font-size: 1.1rem;
                }

                .tracking-info i {
                    font-size: 24px;
                    color: #FF6B35;
                }

                .tracking-label {
                    color: #7f8c8d;
                    font-weight: 600;
                }

                .tracking-number {
                    font-size: 1.3rem;
                    font-weight: 800;
                    color: #2c3e50;
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                    padding: 5px 15px;
                    border-radius: 10px;
                }

                .btn-track {
                    background: linear-gradient(135deg, #FF6B35, #F7931E);
                    color: white;
                    padding: 12px 30px;
                    border-radius: 25px;
                    text-decoration: none;
                    font-weight: 600;
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    transition: all 0.3s ease;
                    box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
                }

                .btn-track:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
                    color: white;
                    text-decoration: none;
                }

                /* Content Container */
                .shipment-detail-content {
                    padding: 30px 15px;
                }

                /* Info Cards */
                .info-card {
                    background: white;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                    overflow: hidden;
                    height: 100%;
                    transition: all 0.3s ease;
                }

                .info-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 15px 40px rgba(0,0,0,0.12);
                }

                .card-header-modern {
                    padding: 25px;
                    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                    display: flex;
                    align-items: center;
                    gap: 15px;
                }

                .header-icon {
                    width: 50px;
                    height: 50px;
                    border-radius: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 22px;
                }

                .header-icon.sender {
                    background: linear-gradient(135deg, #3498db, #2980b9);
                }

                .header-icon.recipient {
                    background: linear-gradient(135deg, #27ae60, #229954);
                }

                .card-title {
                    font-size: 1.3rem;
                    font-weight: 700;
                    color: #2c3e50;
                    margin: 0;
                }

                .card-body-modern {
                    padding: 25px;
                }

                .info-row {
                    padding: 12px 0;
                    border-bottom: 1px solid #f0f3f6;
                    display: flex;
                    align-items: flex-start;
                    gap: 15px;
                }

                .info-row:last-child {
                    border-bottom: none;
                }

                .info-label {
                    color: #7f8c8d;
                    font-weight: 600;
                    min-width: 120px;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .info-label i {
                    color: #FF6B35;
                    width: 18px;
                }

                .info-value {
                    color: #2c3e50;
                    font-weight: 600;
                    flex: 1;
                }

                .notes-section {
                    margin-top: 20px;
                    padding: 15px;
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.05), rgba(247, 147, 30, 0.05));
                    border-radius: 12px;
                }

                .notes-label {
                    color: #FF6B35;
                    font-weight: 700;
                    margin-bottom: 10px;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .notes-content {
                    color: #2c3e50;
                    line-height: 1.6;
                }

                /* Products Section */
                .products-section {
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                    margin-bottom: 30px;
                }

                .section-header {
                    margin-bottom: 25px;
                    padding-bottom: 15px;
                    border-bottom: 2px solid #f0f3f6;
                }

                .section-title {
                    font-size: 1.5rem;
                    font-weight: 700;
                    color: #2c3e50;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    margin: 0;
                }

                .items-count {
                    font-size: 1rem;
                    color: #7f8c8d;
                    font-weight: 600;
                }

                .products-table-wrapper {
                    overflow-x: auto;
                }

                .products-table-modern {
                    width: 100%;
                    border-collapse: separate;
                    border-spacing: 0;
                }

                .products-table-modern thead {
                    background: linear-gradient(135deg, #004E7C, #0066A6);
                    color: white;
                }

                .products-table-modern thead th {
                    padding: 15px;
                    font-weight: 600;
                    font-size: 0.95rem;
                }

                .products-table-modern tbody tr {
                    border-bottom: 1px solid #f0f3f6;
                    transition: all 0.3s ease;
                }

                .products-table-modern tbody tr:hover {
                    background: rgba(255, 107, 53, 0.05);
                }

                .products-table-modern tbody td {
                    padding: 15px;
                    vertical-align: middle;
                }

                .row-number {
                    width: 40px;
                    height: 40px;
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                    border-radius: 10px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 700;
                    color: #FF6B35;
                }

                .product-name {
                    font-size: 1.05rem;
                    color: #2c3e50;
                }

                .category-badge {
                    background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(41, 128, 185, 0.1));
                    color: #3498db;
                    padding: 5px 12px;
                    border-radius: 15px;
                    font-size: 0.85rem;
                    font-weight: 600;
                }

                .qty-badge {
                    background: #FF6B35;
                    color: white;
                    padding: 5px 12px;
                    border-radius: 8px;
                    font-weight: 700;
                }

                .amount {
                    color: #27ae60;
                    font-weight: 700;
                }

                .special-badge {
                    width: 32px;
                    height: 32px;
                    border-radius: 8px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 2px;
                }

                .special-badge.fragile {
                    background: rgba(241, 196, 15, 0.2);
                    color: #f39c12;
                }

                .special-badge.danger {
                    background: rgba(231, 76, 60, 0.2);
                    color: #e74c3c;
                }

                .products-table-modern tfoot {
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.05), rgba(247, 147, 30, 0.05));
                }

                .products-table-modern tfoot td {
                    padding: 20px 15px;
                    font-weight: 700;
                    font-size: 1.1rem;
                }

                .totals-label {
                    color: #2c3e50;
                }

                .total-qty {
                    color: #FF6B35;
                    font-size: 1.2rem;
                }

                .total-amount {
                    color: #27ae60;
                    font-size: 1.2rem;
                }

                /* Detail Cards */
                .detail-card {
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    overflow: hidden;
                    height: 100%;
                }

                .detail-header {
                    padding: 20px;
                    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }

                .detail-header i {
                    color: #FF6B35;
                    font-size: 20px;
                }

                .detail-header h4 {
                    margin: 0;
                    font-size: 1.2rem;
                    font-weight: 700;
                    color: #2c3e50;
                }

                .detail-body {
                    padding: 20px;
                }

                .detail-item {
                    padding: 12px 0;
                    border-bottom: 1px solid #f0f3f6;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }

                .detail-item:last-child {
                    border-bottom: none;
                }

                .detail-label {
                    color: #7f8c8d;
                    font-weight: 600;
                }

                .detail-value {
                    color: #2c3e50;
                    font-weight: 700;
                }

                .payment-badge {
                    padding: 6px 14px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                    font-weight: 600;
                }

                .payment-badge.prepaid {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(34, 153, 84, 0.1));
                    color: #27ae60;
                }

                .payment-badge.cod {
                    background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(230, 126, 34, 0.1));
                    color: #f39c12;
                }

                /* Timeline */
                .timeline-item {
                    display: flex;
                    align-items: center;
                    gap: 15px;
                    padding: 15px 0;
                    border-bottom: 1px solid #f0f3f6;
                }

                .timeline-item:last-child {
                    border-bottom: none;
                }

                .timeline-icon {
                    width: 40px;
                    height: 40px;
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #FF6B35;
                    flex-shrink: 0;
                }

                .timeline-item.completed .timeline-icon {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(34, 153, 84, 0.1));
                    color: #27ae60;
                }

                .timeline-content {
                    flex: 1;
                }

                .timeline-label {
                    color: #7f8c8d;
                    font-weight: 600;
                    display: block;
                    margin-bottom: 5px;
                }

                .timeline-date {
                    color: #2c3e50;
                    font-weight: 700;
                }

                .timeline-date.success {
                    color: #27ae60;
                }

                /* Pricing Section */
                .pricing-section {
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                    margin-bottom: 30px;
                }

                .pricing-content {
                    margin-top: 25px;
                }

                .invoice-status h5,
                .price-breakdown h5 {
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: #2c3e50;
                    margin-bottom: 20px;
                }

                .status-pill {
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    border-radius: 25px;
                    font-weight: 600;
                }

                .status-pill.confirmed {
                    background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(34, 153, 84, 0.1));
                    color: #27ae60;
                }

                .status-pill.draft {
                    background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(230, 126, 34, 0.1));
                    color: #f39c12;
                }

                .status-pill.pending {
                    background: linear-gradient(135deg, rgba(149, 165, 166, 0.1), rgba(127, 140, 141, 0.1));
                    color: #7f8c8d;
                }

                .price-item {
                    padding: 15px;
                    background: #f8f9fa;
                    border-radius: 12px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 10px;
                }

                .price-item.total {
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                }

                .price-label {
                    font-weight: 600;
                    color: #7f8c8d;
                }

                .price-value {
                    font-size: 1.3rem;
                    font-weight: 800;
                    color: #FF6B35;
                }

                .cod-notice {
                    background: linear-gradient(135deg, rgba(241, 196, 15, 0.1), rgba(230, 126, 34, 0.1));
                    padding: 15px;
                    border-radius: 12px;
                    color: #f39c12;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    margin-top: 10px;
                }

                /* Notes Card */
                .notes-card {
                    background: white;
                    border-radius: 20px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                    overflow: hidden;
                    margin-bottom: 30px;
                }

                .notes-header {
                    padding: 20px 30px;
                    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }

                .notes-header i {
                    color: #FF6B35;
                    font-size: 20px;
                }

                .notes-header h4 {
                    margin: 0;
                    font-size: 1.2rem;
                    font-weight: 700;
                    color: #2c3e50;
                }

                .notes-body {
                    padding: 30px;
                    color: #2c3e50;
                    line-height: 1.8;
                }

                /* Action Buttons */
                .action-buttons-section {
                    text-align: center;
                    margin-top: 40px;
                    display: flex;
                    gap: 15px;
                    justify-content: center;
                    flex-wrap: wrap;
                }

                .action-btn {
                    padding: 15px 35px;
                    border-radius: 30px;
                    font-weight: 700;
                    text-decoration: none;
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                    transition: all 0.3s ease;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
                }

                .action-btn.primary {
                    background: linear-gradient(135deg, #FF6B35, #F7931E);
                    color: white;
                }

                .action-btn.success {
                    background: linear-gradient(135deg, #27ae60, #229954);
                    color: white;
                }

                .action-btn.secondary {
                    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
                    color: white;
                }

                .action-btn:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
                    color: white;
                    text-decoration: none;
                }

                /* Responsive */
                @media (max-width: 768px) {
                    .shipment-title {
                        font-size: 1.8rem;
                    }

                    .tracking-content {
                        flex-direction: column;
                    }

                    .action-buttons-section {
                        flex-direction: column;
                    }

                    .action-btn {
                        width: 100%;
                        justify-content: center;
                    }
                }







            </style>
        </t>
    </template>




        <template id="portal_my_invoices" name="My Invoices Dashboard">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="False"/>

            <!-- Main Dashboard Section -->
            <div class="invoice-dashboard-container">
                <!-- Animated Header Section -->
                <div class="dashboard-header-wrapper">
                    <div class="header-bg-animation"></div>
                    <div class="container">
                        <div class="header-content">
                            <div class="header-icon-float">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h1 class="header-title">لوحة التحكم المالية</h1>
                            <p class="header-subtitle">إدارة ومتابعة جميع فواتيرك ومدفوعاتك</p>
                            <div class="header-decorative-line"></div>
                        </div>
                    </div>
                </div>

                <!-- Modern Stats Section -->
                <div class="stats-section">
                    <div class="container">
                        <div class="row">


                            <!-- Outstanding Card -->
                            <div class="col-xl-3 col-lg-6 col-md-6 mb-4">
                                <div class="modern-stat-card card-outstanding">
                                    <div class="card-background"></div>
                                    <div class="card-inner">
                                        <div class="icon-container">
                                            <div class="icon-bg"></div>
                                            <i class="fa fa-clock-o"></i>
                                        </div>
                                        <div class="stat-details">
                                            <span class="stat-label">المبلغ المستحق</span>
                                            <h2 class="stat-number">
                                                <span class="counter">
                                                    <t t-esc="int(unpaid_amount or 0)"/>
                                                </span>
                                                <span class="currency">EGP</span>
                                            </h2>
                                            <div class="stat-badge warning">
                                                <t t-esc="unpaid_count or 0"/> بانتظار الدفع
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

                <!-- Table Section -->
                <div class="container">
                    <div class="table-section">
                        <div class="section-header">
                            <h3 class="section-title">
                                <i class="fa fa-list"></i>
                                قائمة الفواتير
                            </h3>

                        </div>

                        <t t-if="not invoices">
                            <div class="empty-state-modern">
                                <div class="empty-illustration">
                                    <svg viewBox="0 0 200 200" width="200" height="200">
                                        <circle cx="100" cy="100" r="80" fill="#f0f4f8"/>
                                        <rect x="70" y="70" width="60" height="80" rx="5" fill="#dde4ed"/>
                                        <line x1="85" y1="90" x2="115" y2="90" stroke="#a0aec0" stroke-width="3"/>
                                        <line x1="85" y1="105" x2="115" y2="105" stroke="#a0aec0" stroke-width="3"/>
                                        <line x1="85" y1="120" x2="100" y2="120" stroke="#a0aec0" stroke-width="3"/>
                                    </svg>
                                </div>
                                <h3>لا توجد فواتير حالياً</h3>
                                <p>ابدأ بإنشاء شحنة جديدة لتظهر الفواتير هنا</p>
                                <a href="/my/shipments" class="btn-create-new">
                                    <i class="fas fa-plus-circle"></i>
                                    إنشاء شحنة جديدة
                                </a>
                            </div>
                        </t>

                        <t t-if="invoices">
                            <div class="modern-table-wrapper">
                                <table class="modern-table">
                                    <thead>
                                        <tr>
                                            <th>
                                                <div class="th-content">

                                                    رقم الفاتورة
                                                </div>
                                            </th>
                                            <th>
                                                <div class="th-content">

                                                    التاريخ
                                                </div>
                                            </th>
                                            <th>
                                                <div class="th-content">

                                                    الاستحقاق
                                                </div>
                                            </th>
                                            <th>
                                                <div class="th-content">

                                                    الشحنة
                                                </div>
                                            </th>
                                            <th>
                                                <div class="th-content">

                                                    الحالة
                                                </div>
                                            </th>
                                            <th>
                                                <div class="th-content">

                                                    المبلغ
                                                </div>
                                            </th>
                                            <th>
                                                <div class="th-content">

                                                    الرصيد
                                                </div>
                                            </th>
                                            <th class="text-center">
                                                <div class="th-content">

                                                    عرض التفاصيل
                                                </div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="invoices" t-as="invoice">
                                            <tr class="table-row-modern">
                                                <td>
                                                    <a t-att-href="'/my/invoice/%s' % invoice.id" class="invoice-number-link">
                                                        <span class="invoice-icon">
                                                            <i class="fa fa-file"></i>
                                                        </span>
                                                        <t t-esc="invoice.name"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <div class="date-cell">
                                                        <t t-esc="invoice.invoice_date" t-options='{"widget": "date"}'/>
                                                    </div>
                                                </td>
                                                <td>
                                                    <t t-if="invoice.invoice_date_due">
                                                        <div class="date-cell due-date">
                                                            <t t-esc="invoice.invoice_date_due" t-options='{"widget": "date"}'/>
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="no-data">-</span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <t t-if="invoice.shipment_id">
                                                        <a t-att-href="'/my/shipment/%s' % invoice.shipment_id.id"
                                                           class="shipment-pill">
                                                            <i class="fas fa-box"></i>
                                                            <t t-esc="invoice.shipment_id.order_number"/>
                                                        </a>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="no-data">-</span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <t t-if="invoice.state == 'draft'">
                                                        <span class="status-badge draft">
                                                            <span class="status-dot"></span>
                                                            مسودة
                                                        </span>
                                                    </t>
                                                    <t t-elif="invoice.payment_state == 'paid'">
                                                        <span class="status-badge paid">
                                                            <span class="status-dot"></span>
                                                            مدفوعة
                                                        </span>
                                                    </t>
                                                    <t t-elif="invoice.payment_state == 'partial'">
                                                        <span class="status-badge partial">
                                                            <span class="status-dot"></span>
                                                            دفع جزئي
                                                        </span>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="status-badge unpaid">
                                                            <span class="status-dot"></span>
                                                            غير مدفوعة
                                                        </span>
                                                    </t>
                                                </td>
                                                <td>
                                                    <div class="amount-display">
                                                        <span class="amount-value">
                                                            <t t-esc="int(invoice.amount_total)"/>
                                                        </span>
                                                        <span class="amount-currency">EGP</span>
                                                    </div>
                                                </td>
                                                <td>
                                                    <t t-if="invoice.amount_residual > 0">
                                                        <div class="balance-due">
                                                            <t t-esc="int(invoice.amount_residual)"/> EGP
                                                        </div>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="balance-settled">
                                                            <i class="fa fa-check-circle"></i>
                                                            مسددة
                                                        </div>
                                                    </t>
                                                </td>
                                                <td>
                                                    <div class="actions-group">
                                                        <a t-att-href="'/my/invoice/%s' % invoice.id"
                                                           class="action-btn view" title="عرض التفاصيل">
                                                            <i class="fa fa-eye"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </t>
                    </div>
                </div>
            </div>

            <!-- Enhanced Styles -->
            <style>
                /* Reset &amp; Base */
                .invoice-dashboard-container {
                    min-height: 100vh;
                    background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
                    padding-bottom: 60px;
                }

                /* Animated Header */
                .dashboard-header-wrapper {
                    position: relative;
                    background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
                    padding: 80px 0 120px;
                    overflow: hidden;
                }

                .header-bg-animation {
                    position: absolute;
                    top: -50%;
                    left: -50%;
                    width: 200%;
                    height: 200%;
                    background: radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%),
                                radial-gradient(circle at 40% 40%, rgba(255,255,255,0.05) 0%, transparent 50%);
                    animation: bgRotate 20s linear infinite;
                }

                @keyframes bgRotate {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }

                .header-content {
                    position: relative;
                    text-align: center;
                    z-index: 2;
                }

                .header-icon-float {
                    width: 80px;
                    height: 80px;
                    margin: 0 auto 20px;
                    background: rgba(255,255,255,0.2);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 36px;
                    color: white;
                    animation: float 3s ease-in-out infinite;
                }

                @keyframes float {
                    0%, 100% { transform: translateY(0); }
                    50% { transform: translateY(-10px); }
                }

                .header-title {
                    font-size: 3rem;
                    font-weight: 800;
                    color: white;
                    margin-bottom: 10px;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
                }

                .header-subtitle {
                    font-size: 1.2rem;
                    color: rgba(255,255,255,0.95);
                    margin-bottom: 20px;
                }

                .header-decorative-line {
                    width: 80px;
                    height: 4px;
                    background: rgba(255,255,255,0.5);
                    margin: 0 auto;
                    border-radius: 2px;
                }

                /* Stats Section */
                .stats-section {
                    margin-top: -80px;
                    position: relative;
                    z-index: 10;
                    padding: 0 15px;
                }

                /* Modern Stat Cards */
                .modern-stat-card {
                    background: white;
                    border-radius: 20px;
                    padding: 0;
                    height: 160px;
                    position: relative;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                }

                .modern-stat-card:hover {
                    transform: translateY(-8px);
                    box-shadow: 0 20px 40px rgba(0,0,0,0.12);
                }

                .card-background {
                    position: absolute;
                    top: 0;
                    right: 0;
                    width: 40%;
                    height: 100%;
                    opacity: 0.05;
                    background: linear-gradient(135deg, currentColor, transparent);
                }

                .card-inner {
                    padding: 25px;
                    display: flex;
                    align-items: center;
                    gap: 20px;
                    height: 100%;
                }

                .icon-container {
                    position: relative;
                    width: 60px;
                    height: 60px;
                    flex-shrink: 0;
                }

                .icon-bg {
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    border-radius: 16px;
                    opacity: 0.1;
                }

                .icon-container i {
                    position: relative;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 28px;
                }

                /* Card Color Themes */
                .card-invoices {
                    color: #3498db;
                }

                .card-invoices .icon-bg {
                    background: linear-gradient(135deg, #3498db, #2980b9);
                }

                .card-amount {
                    color: #9b59b6;
                }

                .card-amount .icon-bg {
                    background: linear-gradient(135deg, #9b59b6, #8e44ad);
                }

                .card-paid {
                    color: #27ae60;
                }

                .card-paid .icon-bg {
                    background: linear-gradient(135deg, #27ae60, #229954);
                }

                .card-outstanding {
                    color: #e74c3c;
                }

                .card-outstanding .icon-bg {
                    background: linear-gradient(135deg, #e74c3c, #c0392b);
                }

                .stat-details {
                    flex: 1;
                }

                .stat-label {
                    display: block;
                    font-size: 0.9rem;
                    color: #7f8c8d;
                    margin-bottom: 5px;
                    font-weight: 600;
                }

                .stat-number {
                    font-size: 2rem;
                    font-weight: 800;
                    line-height: 1.2;
                    margin: 0;
                }

                .currency {
                    font-size: 0.9rem;
                    color: #95a5a6;
                    margin-left: 5px;
                }

                .stat-trend,
                .stat-badge {
                    display: inline-block;
                    padding: 4px 12px;
                    background: rgba(0,0,0,0.05);
                    border-radius: 20px;
                    font-size: 0.8rem;
                    margin-top: 8px;
                    font-weight: 600;
                }

                .stat-badge.success {
                    background: rgba(39, 174, 96, 0.1);
                    color: #27ae60;
                }

                .stat-badge.warning {
                    background: rgba(231, 76, 60, 0.1);
                    color: #e74c3c;
                }

                .mini-chart {
                    margin-top: 10px;
                    height: 30px;
                    opacity: 0.3;
                }

                /* Payment Overview */
                .payment-overview-card {
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    margin-top: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                }

                .overview-title {
                    font-size: 1.3rem;
                    font-weight: 700;
                    color: #2c3e50;
                    margin-bottom: 25px;
                }

                .payment-progress-container {
                    position: relative;
                }

                .progress-info {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 15px;
                    font-weight: 600;
                }

                .percentage {
                    font-size: 1.5rem;
                    color: #FF6B35;
                }

                .custom-progress-bar {
                    height: 20px;
                    background: #f0f3f6;
                    border-radius: 10px;
                    overflow: hidden;
                    position: relative;
                }

                .progress-fill {
                    height: 100%;
                    background: linear-gradient(90deg, #FF6B35 0%, #F7931E 100%);
                    border-radius: 10px;
                    position: relative;
                    transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
                }

                .progress-glow {
                    position: absolute;
                    top: 0;
                    right: 0;
                    bottom: 0;
                    width: 100px;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
                    animation: glow 2s linear infinite;
                }

                @keyframes glow {
                    from { transform: translateX(-100px); }
                    to { transform: translateX(100px); }
                }

                .progress-labels {
                    display: flex;
                    justify-content: space-between;
                    margin-top: 15px;
                    font-size: 0.9rem;
                }

                .label-paid {
                    color: #27ae60;
                    font-weight: 600;
                }

                .label-unpaid {
                    color: #e74c3c;
                    font-weight: 600;
                }

                /* Table Section */
                .table-section {
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    margin-top: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
                }

                .section-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 30px;
                    padding-bottom: 20px;
                    border-bottom: 2px solid #f0f3f6;
                }

                .section-title {
                    font-size: 1.5rem;
                    font-weight: 700;
                    color: #2c3e50;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }

                .section-actions {
                    display: flex;
                    gap: 10px;
                }

                .btn-filter,
                .btn-export {
                    padding: 10px 20px;
                    border: 2px solid #e0e6ed;
                    background: white;
                    border-radius: 10px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .btn-filter:hover,
                .btn-export:hover {
                    background: #f8f9fa;
                    border-color: #FF6B35;
                    color: #FF6B35;
                }

                /* Modern Table */
                .modern-table-wrapper {
                    overflow-x: auto;
                }

                .modern-table {
                    width: 100%;
                    border-collapse: separate;
                    border-spacing: 0 10px;
                }

                .modern-table thead tr {
                    background: #f8f9fa;
                }

                .modern-table thead th {
                    padding: 15px;
                    font-weight: 600;
                    color: #7f8c8d;
                    font-size: 0.9rem;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                    border: none;
                }

                .th-content {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .th-content i {
                    font-size: 14px;
                    opacity: 0.6;
                }

                .table-row-modern {
                    background: white;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
                    transition: all 0.3s ease;
                }

                .table-row-modern:hover {
                    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                    transform: scale(1.01);
                }

                .table-row-modern td {
                    padding: 20px 15px;
                    vertical-align: middle;
                    border: none;
                    border-top: 1px solid #f0f3f6;
                    border-bottom: 1px solid #f0f3f6;
                }

                .table-row-modern td:first-child {
                    border-left: 1px solid #f0f3f6;
                    border-radius: 10px 0 0 10px;
                }

                .table-row-modern td:last-child {
                    border-right: 1px solid #f0f3f6;
                    border-radius: 0 10px 10px 0;
                }

                /* Table Elements */
                .invoice-number-link {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    color: #2c3e50;
                    text-decoration: none;
                    font-weight: 700;
                    transition: all 0.3s ease;
                }

                .invoice-number-link:hover {
                    color: #FF6B35;
                }

                .invoice-icon {
                    width: 35px;
                    height: 35px;
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
                    border-radius: 10px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #FF6B35;
                }

                .date-cell {
                    background: #f8f9fa;
                    padding: 8px 12px;
                    border-radius: 8px;
                    display: inline-block;
                    font-weight: 600;
                    font-size: 0.9rem;
                }

                .date-cell.due-date {
                    background: rgba(255, 107, 53, 0.1);
                    color: #FF6B35;
                }

                .shipment-pill {
                    display: inline-flex;
                    align-items: center;
                    gap: 6px;
                    background: linear-gradient(135deg, rgba(0, 78, 124, 0.1), rgba(0, 102, 166, 0.1));
                    color: #004E7C;
                    padding: 6px 14px;
                    border-radius: 20px;
                    text-decoration: none;
                    font-weight: 600;
                    font-size: 0.9rem;
                    transition: all 0.3s ease;
                }

                .shipment-pill:hover {
                    background: linear-gradient(135deg, #004E7C, #0066A6);
                    color: white;
                    transform: translateY(-2px);
                }

                .status-badge {
                    display: inline-flex;
                    align-items: center;
                    gap: 6px;
                    padding: 8px 14px;
                    border-radius: 20px;
                    font-weight: 600;
                    font-size: 0.85rem;
                }

                .status-dot {
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                    animation: pulse 2s infinite;
                }

                @keyframes pulse {
                    0%, 100% { opacity: 1; }
                    50% { opacity: 0.5; }
                }

                .status-badge.draft {
                    background: rgba(52, 152, 219, 0.1);
                    color: #3498db;
                }

                .status-badge.draft .status-dot {
                    background: #3498db;
                }

                .status-badge.paid {
                    background: rgba(39, 174, 96, 0.1);
                    color: #27ae60;
                }

                .status-badge.paid .status-dot {
                    background: #27ae60;
                }

                .status-badge.partial {
                    background: rgba(241, 196, 15, 0.1);
                    color: #f39c12;
                }

                .status-badge.partial .status-dot {
                    background: #f39c12;
                }

                .status-badge.unpaid {
                    background: rgba(231, 76, 60, 0.1);
                    color: #e74c3c;
                }

                .status-badge.unpaid .status-dot {
                    background: #e74c3c;
                }

                .amount-display {
                    font-weight: 700;
                    font-size: 1.1rem;
                    color: #2c3e50;
                }

                .amount-currency {
                    font-size: 0.85rem;
                    color: #95a5a6;
                    margin-left: 4px;
                }

                .balance-due {
                    color: #e74c3c;
                    font-weight: 700;
                    font-size: 1rem;
                }

                .balance-settled {
                    color: #27ae60;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }

                .no-data {
                    color: #bdc3c7;
                    font-style: italic;
                }

                /* Action Buttons */
                .actions-group {
                    display: flex;
                    gap: 8px;
                    justify-content: center;
                }

                .action-btn {
                    width: 36px;
                    height: 36px;
                    border-radius: 10px;
                    border: none;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    color: white;
                    text-decoration: none;
                }

                .action-btn.view {
                    background: linear-gradient(135deg, #3498db, #2980b9);
                }

                .action-btn.download {
                    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
                }

                .action-btn.pay {
                    background: linear-gradient(135deg, #FF6B35, #F7931E);
                }

                .action-btn:hover {
                    transform: translateY(-3px) scale(1.1);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                }

                /* Empty State */
                .empty-state-modern {
                    text-align: center;
                    padding: 60px 20px;
                }

                .empty-illustration {
                    margin-bottom: 30px;
                    animation: float 3s ease-in-out infinite;
                }

                .empty-state-modern h3 {
                    font-size: 1.8rem;
                    font-weight: 700;
                    color: #2c3e50;
                    margin-bottom: 10px;
                }

                .empty-state-modern p {
                    color: #7f8c8d;
                    font-size: 1.1rem;
                    margin-bottom: 30px;
                }

                .btn-create-new {
                    display: inline-flex;
                    align-items: center;
                    gap: 10px;
                    background: linear-gradient(135deg, #FF6B35, #F7931E);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 30px;
                    text-decoration: none;
                    font-weight: 700;
                    transition: all 0.3s ease;
                    box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
                }

                .btn-create-new:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 15px 40px rgba(255, 107, 53, 0.4);
                }

                /* Responsive */
                @media (max-width: 1200px) {
                    .modern-stat-card {
                        height: auto;
                        min-height: 140px;
                    }
                }

                @media (max-width: 768px) {
                    .header-title {
                        font-size: 2rem;
                    }

                    .section-header {
                        flex-direction: column;
                        gap: 20px;
                    }

                    .modern-table {
                        font-size: 0.85rem;
                    }

                    .action-btn {
                        width: 32px;
                        height: 32px;
                    }

                    .modern-stat-card .card-inner {
                        flex-direction: column;
                        text-align: center;
                    }
                }
            </style>

            <!-- Enhanced JavaScript -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Advanced counter animation
                    const counters = document.querySelectorAll('.counter');
                    const options = {
                        threshold: 0.5,
                        rootMargin: '0px 0px -100px 0px'
                    };

                    const startCounting = (entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const counter = entry.target;
                                const target = parseInt(counter.getAttribute('data-target') || counter.innerText);
                                const duration = 2000;
                                const step = target / (duration / 16);
                                let current = 0;

                                const updateCounter = () => {
                                    current += step;
                                    if (current &lt; target) {
                                        counter.innerText = Math.ceil(current);
                                        requestAnimationFrame(updateCounter);
                                    } else {
                                        counter.innerText = target.toLocaleString();
                                    }
                                };

                                updateCounter();
                                observer.unobserve(counter);
                            }
                        });
                    };

                    const observer = new IntersectionObserver(startCounting, options);
                    counters.forEach(counter => observer.observe(counter));

                    // Add stagger animation to table rows
                    const rows = document.querySelectorAll('.table-row-modern');
                    rows.forEach((row, index) => {
                        row.style.opacity = '0';
                        row.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            row.style.transition = 'all 0.5s ease';
                            row.style.opacity = '1';
                            row.style.transform = 'translateY(0)';
                        }, index * 100);
                    });

                    // Filter button functionality
                    document.querySelector('.btn-filter')?.addEventListener('click', function() {
                        alert('ميزة التصفية قيد التطوير');
                    });

                    // Export button functionality
                    document.querySelector('.btn-export')?.addEventListener('click', function() {
                        alert('ميزة التصدير قيد التطوير');
                    });
                });
            </script>
        </t>
    </template>

<!-- Invoice Detail View -->

    <template id="portal_my_invoice_detail" name="Invoice Detail">
        <t t-call="portal.portal_layout">
            <!-- Invoice Header with Gradient -->
            <div class="torood-portal-header" style="text-align: center;">
                <div class="container">
                    <h2>
                        <i class="fa fa-file"></i>
                        تفاصيل الفاتورة
                    </h2>
                    <p>معلومات الفاتورة والدفع</p>
                </div>
            </div>

            <div class="container mt-4">
                <!-- Main Invoice Card -->
                <div class="torood-card fade-in-up">
                    <!-- Invoice Header Info -->
                    <div class="torood-card-header">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h3 class="mb-0">
                                    <i class="fa fa-slack"></i>
                                    <t t-esc="invoice.name"/>
                                </h3>
                            </div>
                            <div class="col-md-6 text-md-right">
                                <t t-if="invoice.state == 'draft'">
                                    <span class="badge-torood badge-torood-info">
                                        <i class="fa fa-pencil"></i> مسودة
                                    </span>
                                </t>
                                <t t-elif="invoice.payment_state == 'paid'">
                                    <span class="badge-torood badge-torood-success">
                                        <i class="fa fa-check-circle"></i> مدفوعة
                                    </span>
                                </t>
                                <t t-elif="invoice.payment_state == 'partial'">
                                    <span class="badge-torood badge-torood-warning">
                                        <i class="fa fa-exclamation-triangle"></i> دفع جزئي
                                    </span>
                                </t>
                                <t t-else="">
                                    <span class="badge-torood badge-torood-warning">
                                        <i class="fa fa-clock-o"></i> غير مدفوعة
                                    </span>
                                </t>
                            </div>
                        </div>
                    </div>

                    <div class="torood-card-body">
                        <!-- Invoice Details Row -->
                        <div class="row mb-4">
                            <!-- Invoice Information -->
                            <div class="col-lg-6 mb-4">
                                <div class="info-section">
                                    <h5 class="section-title">
                                        <i class="fa fa-info-circle mr-2" style="color: var(--torood-primary);"></i>
                                        معلومات الفاتورة
                                    </h5>
                                    <div class="info-box">
                                        <table class="table table-borderless info-table">
                                            <tr>
                                                <td class="info-label">
                                                    <i class="fas fa-calendar-alt mr-2"></i>
                                                    تاريخ الفاتورة:
                                                </td>
                                                <td class="info-value">
                                                    <t t-esc="invoice.invoice_date" t-options='{"widget": "date"}'/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="info-label">
                                                    <i class="fas fa-calendar-check mr-2"></i>
                                                    تاريخ الاستحقاق:
                                                </td>
                                                <td class="info-value">
                                                    <t t-if="invoice.invoice_date_due">
                                                        <span t-field="invoice.invoice_date_due" t-options='{"widget": "date"}'/>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="text-muted">غير محدد</span>
                                                    </t>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="info-label">
                                                    <i class="fa fa-truck mr-2"></i>
                                                    الشحنة المرتبطة:
                                                </td>
                                                <td class="info-value">
                                                    <t t-if="invoice.shipment_id">
                                                        <a t-att-href="'/my/shipment/%s' % invoice.shipment_id.id"
                                                           class="shipment-link">
                                                            <i class="fas fa-external-link-alt mr-1"></i>
                                                            <t t-esc="invoice.shipment_id.order_number"/>
                                                        </a>
                                                    </t>
                                                    <t t-else="">
                                                        <span class="text-muted">لا يوجد</span>
                                                    </t>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Payment Information -->
                            <div class="col-lg-6 mb-4">
                                <div class="info-section">
                                    <h5 class="section-title">
                                        <i class="fa fa-credit-card mr-2" style="color: var(--torood-secondary);"></i>
                                        معلومات الدفع
                                    </h5>
                                    <div class="payment-summary-box">
                                        <div class="payment-item">
                                            <span class="payment-label">المبلغ الإجمالي:</span>
                                            <span class="payment-value total">
                                                <t t-esc="'%.2f' % invoice.amount_total"/> جنيه
                                            </span>
                                        </div>
                                        <div class="payment-item">
                                            <span class="payment-label">المبلغ المدفوع:</span>
                                            <span class="payment-value paid">
                                                <t t-esc="'%.2f' % (invoice.amount_total - invoice.amount_residual)"/> جنيه
                                            </span>
                                        </div>
                                        <div class="payment-item balance">
                                            <span class="payment-label">المبلغ المتبقي:</span>
                                            <span class="payment-value">
                                                <t t-if="invoice.amount_residual > 0">
                                                    <span class="text-danger">
                                                        <t t-esc="'%.2f' % invoice.amount_residual"/> جنيه
                                                    </span>
                                                </t>
                                                <t t-else="">
                                                    <span class="text-success">
                                                        <i class="fa fa-check-circle"></i> تم السداد
                                                    </span>
                                                </t>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Invoice Items Table -->
                        <div class="invoice-items-section">
                            <h5 class="section-title mb-3">
                                <i class="fa fa-list-alt mr-2" style="color: var(--torood-primary);"></i>
                                بنود الفاتورة
                            </h5>
                            <div class="table-responsive">
                                <table class="table torood-table">
                                    <thead>
                                        <tr>
                                            <th style="color:White;">#</th>
                                            <th style="color:White;">الوصف</th>
                                            <th class="text-center" style="color:White;"></th>
                                            <th class="text-right" style="color:White;">سعر الوحدة</th>
                                            <th class="text-right" style="color:White;">الإجمالي</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="invoice.invoice_line_ids" t-as="line">
                                            <tr class="fade-in-up">
                                                <td><t t-esc="line_index + 1"/></td>
                                                <td>
                                                    <strong><t t-esc="line.name"/></strong>
                                                </td>
                                                <td class="text-center">

                                                </td>
                                                <td class="text-right">
                                                    <t t-esc="'%.2f' % line.price_unit"/> جنيه
                                                </td>
                                                <td class="text-right">
                                                    <strong><t t-esc="'%.2f' % line.price_subtotal"/> جنيه</strong>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                    <tfoot>
                                        <tr class="table-footer">
                                            <td colspan="4" class="text-right">
                                                <strong>المجموع الكلي:</strong>
                                            </td>
                                            <td class="text-right">
                                                <span class="total-amount">
                                                    <t t-esc="'%.2f' % invoice.amount_total"/> جنيه
                                                </span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="invoice-actions">

                            <a href="/my/invoices" class="btn-outline-torood">
                                <i class="fa fa-arrow-right"></i>
                                العودة للفواتير
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Custom Styles for Invoice Page -->
            <style>
                /* Info Sections */
                .info-section {
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.03) 0%, rgba(0, 78, 124, 0.03) 100%);
                    border-radius: 15px;
                    padding: 20px;
                    height: 100%;
                }

                .section-title {
                    font-size: 1.2rem;
                    font-weight: 700;
                    color: var(--torood-dark);
                    margin-bottom: 20px;
                    padding-bottom: 10px;
                    border-bottom: 2px solid rgba(255, 107, 53, 0.2);
                }

                /* Info Box */
                .info-box {
                    background: white;
                    border-radius: 10px;
                    padding: 15px;
                }

                .info-table td {
                    padding: 10px 0;
                }

                .info-label {
                    color: #666;
                    font-weight: 600;
                    font-size: 0.95rem;
                }

                .info-value {
                    color: var(--torood-dark);
                    font-weight: 600;
                    font-size: 1rem;
                }

                /* Shipment Link */
                .shipment-link {
                    color: var(--torood-primary);
                    text-decoration: none;
                    font-weight: 600;
                    padding: 5px 12px;
                    background: rgba(255, 107, 53, 0.1);
                    border-radius: 20px;
                    display: inline-block;
                    transition: all 0.3s ease;
                }

                .shipment-link:hover {
                    background: var(--torood-primary);
                    color: white;
                    transform: translateY(-2px);
                }

                /* Payment Summary */
                .payment-summary-box {
                    background: white;
                    border-radius: 10px;
                    padding: 20px;
                    border: 2px solid rgba(0, 78, 124, 0.1);
                }

                .payment-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 12px 0;
                    border-bottom: 1px solid #f0f0f0;
                }

                .payment-item:last-child {
                    border-bottom: none;
                }

                .payment-item.balance {
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, rgba(247, 147, 30, 0.05) 100%);
                    margin: -20px;
                    margin-top: 10px;
                    padding: 20px;
                    border-radius: 0 0 8px 8px;
                    border-bottom: none;
                }

                .payment-label {
                    color: #666;
                    font-weight: 600;
                }

                .payment-value {
                    font-size: 1.1rem;
                    font-weight: 700;
                    color: var(--torood-dark);
                }

                .payment-value.total {
                    color: var(--torood-secondary);
                    font-size: 1.3rem;
                }

                .payment-value.paid {
                    color: var(--torood-primary);
                }

                /* Table Styles */
                .torood-table {
                    background: white;
                    border-radius: 10px;
                    overflow: hidden;
                }

                .torood-table thead {
                    background: var(--torood-gradient-secondary);
                    color: white;
                }

                .torood-table thead th {
                    padding: 15px;
                    font-weight: 600;
                    border: none;
                }

                .torood-table tbody tr {
                    border-bottom: 1px solid #f0f0f0;
                    transition: all 0.3s ease;
                }

                .torood-table tbody tr:hover {
                    background: rgba(255, 107, 53, 0.05);
                }

                .torood-table tbody td {
                    padding: 15px;
                    vertical-align: middle;
                }

                .quantity-badge {
                    background: var(--torood-gradient-primary);
                    color: white;
                    padding: 5px 12px;
                    border-radius: 15px;
                    font-weight: 600;
                }

                .table-footer {
                    background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, rgba(0, 78, 124, 0.05) 100%);
                }

                .table-footer td {
                    padding: 20px 15px;
                    font-size: 1.1rem;
                }

                .total-amount {
                    font-size: 1.5rem;
                    font-weight: 800;
                    color: var(--torood-primary);
                }

                /* Action Buttons */
                .invoice-actions {
                    text-align: center;
                    margin-top: 40px;
                    display: flex;
                    gap: 15px;
                    justify-content: center;
                    flex-wrap: wrap;
                }

                .btn-outline-torood {
                    background: transparent;
                    color: var(--torood-secondary);
                    border: 2px solid var(--torood-secondary);
                    padding: 12px 30px;
                    border-radius: 30px;
                    font-weight: 600;
                    text-decoration: none;
                    display: inline-block;
                    transition: all 0.3s ease;
                }

                .btn-outline-torood:hover {
                    background: var(--torood-secondary);
                    color: white;
                    transform: translateY(-3px);
                }

                /* Responsive */
                @media (max-width: 768px) {
                    .invoice-actions {
                        flex-direction: column;
                    }

                    .invoice-actions a,
                    .invoice-actions button {
                        width: 100%;
                    }

                    .payment-value.total {
                        font-size: 1.1rem;
                    }

                    .total-amount {
                        font-size: 1.2rem;
                    }
                }
            </style>
        </t>
    </template>



</odoo>