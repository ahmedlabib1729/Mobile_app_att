<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- صفحة طلب الشحن -->
    <template id="shipment_request_form" name="Shipment Request Form">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-4 mb-5">
                    <h1 class="text-center mb-4">Request Shipment</h1>

                    <!-- عرض الأخطاء إن وجدت -->
                    <t t-if="error_message">
                        <div class="alert alert-danger">
                            <t t-foreach="error_message" t-as="msg">
                                <p t-esc="msg"/>
                            </t>
                        </div>
                    </t>

                    <form action="/shipment/submit" method="post" class="shipment-form">
                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                        <!-- معلومات المرسل -->
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h4><i class="fa fa-user"/> Sender Information</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="sender_name">Full Name *</label>
                                        <input type="text" name="sender_name" class="form-control"
                                               t-att-value="sender_name" required="required"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="sender_phone">Phone *</label>
                                        <input type="tel" name="sender_phone" class="form-control"
                                               t-att-value="sender_phone" required="required"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="sender_email">Email</label>
                                        <input type="email" name="sender_email" class="form-control"
                                               t-att-value="sender_email"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="sender_whatsapp">WhatsApp</label>
                                        <input type="tel" name="sender_whatsapp" class="form-control"
                                               t-att-value="sender_whatsapp" placeholder="+201234567890"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 form-group">
                                        <label for="sender_address">Pickup Address *</label>
                                        <textarea name="sender_address" class="form-control" rows="2" required="required">
                                            <t t-esc="sender_address"/>
                                        </textarea>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="sender_city">City *</label>
                                        <input type="text" name="sender_city" class="form-control"
                                               t-att-value="sender_city" required="required"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="sender_country_id">Country *</label>
                                        <select name="sender_country_id" class="form-control" required="required">
                                            <option value="">Select Country</option>
                                            <t t-foreach="countries" t-as="country">
                                                <option t-att-value="country.id"
                                                        t-att-selected="str(country.id) == str(sender_country_id)">
                                                    <t t-esc="country.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="sender_pickup_notes">Pickup Instructions</label>
                                    <textarea name="sender_pickup_notes" class="form-control" rows="2"
                                              placeholder="Floor, building name, landmarks, etc.">
                                        <t t-esc="sender_pickup_notes"/>
                                    </textarea>
                                </div>
                            </div>
                        </div>

                        <!-- معلومات المستلم -->
                        <div class="card mb-4">
                            <div class="card-header bg-success text-white">
                                <h4><i class="fa fa-map-marker"/> Recipient Information</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_name">Full Name *</label>
                                        <input type="text" name="recipient_name" class="form-control"
                                               t-att-value="recipient_name" required="required"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_phone">Phone *</label>
                                        <input type="tel" name="recipient_phone" class="form-control"
                                               t-att-value="recipient_phone" required="required"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_mobile">Alternative Phone</label>
                                        <input type="tel" name="recipient_mobile" class="form-control"
                                               t-att-value="recipient_mobile"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_whatsapp">WhatsApp</label>
                                        <input type="tel" name="recipient_whatsapp" class="form-control"
                                               t-att-value="recipient_whatsapp"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_email">Email</label>
                                        <input type="email" name="recipient_email" class="form-control"
                                               t-att-value="recipient_email"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 form-group">
                                        <label for="recipient_address">Delivery Address *</label>
                                        <textarea name="recipient_address" class="form-control" rows="2" required="required">
                                            <t t-esc="recipient_address"/>
                                        </textarea>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_city">City *</label>
                                        <input type="text" name="recipient_city" class="form-control"
                                               t-att-value="recipient_city" required="required"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="recipient_country_id">Country *</label>
                                        <select name="recipient_country_id" class="form-control" required="required">
                                            <option value="">Select Country</option>
                                            <t t-foreach="countries" t-as="country">
                                                <option t-att-value="country.id"
                                                        t-att-selected="str(country.id) == str(recipient_country_id)">
                                                    <t t-esc="country.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="recipient_delivery_notes">Delivery Instructions</label>
                                    <textarea name="recipient_delivery_notes" class="form-control" rows="2"
                                              placeholder="Floor, building name, call before delivery, etc.">
                                        <t t-esc="recipient_delivery_notes"/>
                                    </textarea>
                                </div>
                            </div>
                        </div>

                        <!-- معلومات الشحنة -->
                        <div class="card mb-4">
                            <div class="card-header bg-info text-white">
                                <h4><i class="fa fa-box"/> Shipment Details</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="product_name">Product Description *</label>
                                        <input type="text" name="product_name" class="form-control"
                                               t-att-value="product_name" required="required"
                                               placeholder="e.g., Electronics, Documents, Clothes"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="category_id">Category</label>
                                        <select name="category_id" class="form-control">
                                            <option value="">Select Category</option>
                                            <t t-foreach="categories" t-as="cat">
                                                <option t-att-value="cat.id">
                                                    <t t-esc="cat.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3 form-group">
                                        <label for="quantity">Quantity *</label>
                                        <input type="number" name="quantity" class="form-control"
                                               t-att-value="quantity or 1" min="1" required="required"/>
                                    </div>
                                    <div class="col-md-3 form-group">
                                        <label for="weight">Weight (KG) *</label>
                                        <input type="number" name="weight" class="form-control"
                                               t-att-value="weight" step="0.1" min="0.1" required="required"/>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label for="product_value">Declared Value (EGP) *</label>
                                        <input type="number" name="product_value" class="form-control"
                                               t-att-value="product_value" step="0.01" min="0" required="required"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4 form-group">
                                        <label for="length">Length (cm)</label>
                                        <input type="number" name="length" class="form-control"
                                               t-att-value="length" step="0.1"/>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label for="width">Width (cm)</label>
                                        <input type="number" name="width" class="form-control"
                                               t-att-value="width" step="0.1"/>
                                    </div>
                                    <div class="col-md-4 form-group">
                                        <label for="height">Height (cm)</label>
                                        <input type="number" name="height" class="form-control"
                                               t-att-value="height" step="0.1"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="shipment_type">Shipment Type</label>
                                        <select name="shipment_type" class="form-control">
                                            <option value="package" selected="selected">Package</option>
                                            <option value="document">Documents</option>
                                            <option value="pallet">Pallet</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label>Special Handling</label>
                                        <div class="form-check">
                                            <input type="checkbox" name="fragile" class="form-check-input" id="fragile"/>
                                            <label class="form-check-label" for="fragile">
                                                Fragile - Handle with care
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Details -->
                        <div class="card mb-4">
                            <div class="card-header bg-warning">
                                <h4><i class="fa fa-credit-card"/> Payment Method</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label for="payment_method">Payment Method *</label>
                                        <select name="payment_method" id="payment_method" class="form-control" required="required">
                                            <option value="prepaid">Prepaid</option>
                                            <option value="cod">Cash on Delivery (COD)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group" id="cod_amount_div" style="display: none;">
                                        <label for="cod_amount">COD Amount (EGP)</label>
                                        <input type="number" name="cod_amount" class="form-control"
                                               t-att-value="cod_amount" step="0.01" min="0"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4><i class="fa fa-comment"/> Additional Notes</h4>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <textarea name="notes" class="form-control" rows="3"
                                              placeholder="Any additional information...">
                                        <t t-esc="notes"/>
                                    </textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fa fa-paper-plane"/> Submit Shipment Request
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- JavaScript للصفحة -->
            <script type="text/javascript">
                $(document).ready(function() {
                    // إظهار/إخفاء حقل COD Amount
                    $('#payment_method').change(function() {
                        if ($(this).val() == 'cod') {
                            $('#cod_amount_div').show();
                        } else {
                            $('#cod_amount_div').hide();
                        }
                    });

                    // Trigger on load
                    $('#payment_method').trigger('change');
                });
            </script>
        </t>
    </template>

    <!-- صفحة النجاح -->
    <template id="shipment_success" name="Shipment Success">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5 mb-5">
                    <div class="row">
                        <div class="col-md-8 offset-md-2">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fa fa-check-circle text-success" style="font-size: 72px;"/>
                                    <h2 class="mt-4 mb-4">Shipment Request Submitted Successfully!</h2>
                                    <p class="lead">Your shipment request has been received and is being processed.</p>

                                    <div class="alert alert-info mt-4">
                                        <h4>Your Tracking Number:</h4>
                                        <h2 class="text-primary"><t t-esc="tracking_number"/></h2>
                                        <p>Please save this number to track your shipment</p>
                                    </div>

                                    <div class="mt-4">
                                        <a href="/shipment/track" class="btn btn-primary btn-lg">
                                            <i class="fa fa-search"/> Track Shipment
                                        </a>
                                        <a href="/shipment" class="btn btn-secondary btn-lg">
                                            <i class="fa fa-plus"/> New Shipment
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- صفحة تتبع الشحنة -->
    <template id="track_shipment" name="Track Shipment">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure">
                <div class="container mt-5 mb-5">
                    <h1 class="text-center mb-4">Track Your Shipment</h1>

                    <!-- نموذج البحث -->
                    <div class="row mb-4">
                        <div class="col-md-8 offset-md-2">
                            <form action="/shipment/track" method="get" class="form-inline justify-content-center">
                                <div class="form-group mr-2">
                                    <input type="text" name="tracking" class="form-control form-control-lg"
                                           placeholder="Enter tracking number" t-att-value="tracking" required="required"/>
                                </div>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fa fa-search"/> Track
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- عرض النتائج -->
                    <t t-if="error">
                        <div class="alert alert-danger text-center">
                            <t t-esc="error"/>
                        </div>
                    </t>

                    <t t-if="shipment">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h4>Shipment Details - <t t-esc="shipment.order_number"/></h4>
                            </div>
                            <div class="card-body">
                                <!-- حالة الشحنة -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h5>Current Status:</h5>
                                        <div class="progress" style="height: 30px;">
                                            <t t-if="shipment.state == 'draft'">
                                                <div class="progress-bar bg-secondary" style="width: 10%">Draft</div>
                                            </t>
                                            <t t-if="shipment.state == 'confirmed'">
                                                <div class="progress-bar bg-info" style="width: 25%">Confirmed</div>
                                            </t>
                                            <t t-if="shipment.state == 'picked'">
                                                <div class="progress-bar bg-warning" style="width: 40%">Picked Up</div>
                                            </t>
                                            <t t-if="shipment.state == 'in_transit'">
                                                <div class="progress-bar bg-primary" style="width: 60%">In Transit</div>
                                            </t>
                                            <t t-if="shipment.state == 'out_for_delivery'">
                                                <div class="progress-bar bg-info" style="width: 80%">Out for Delivery</div>
                                            </t>
                                            <t t-if="shipment.state == 'delivered'">
                                                <div class="progress-bar bg-success" style="width: 100%">Delivered</div>
                                            </t>
                                        </div>
                                    </div>
                                </div>

                                <!-- معلومات الشحنة -->
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5>From:</h5>
                                        <p>
                                            <strong><t t-esc="shipment.sender_id.name"/></strong><br/>
                                            <t t-esc="shipment.sender_city"/>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>To:</h5>
                                        <p>
                                            <strong><t t-esc="shipment.recipient_name"/></strong><br/>
                                            <t t-esc="shipment.recipient_city"/>
                                        </p>
                                    </div>
                                </div>

                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <h5>Pickup Date:</h5>
                                        <p><t t-esc="shipment.pickup_date"/></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h5>Expected Delivery:</h5>
                                        <p><t t-esc="shipment.expected_delivery or 'To be determined'"/></p>
                                    </div>
                                </div>

                                <t t-if="shipment.tracking_number">
                                    <div class="row mt-3">
                                        <div class="col-md-12">
                                            <h5>Tracking Number:</h5>
                                            <p class="text-primary font-weight-bold"><t t-esc="shipment.tracking_number"/></p>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Email Template -->
    <record id="shipment_confirmation_email" model="mail.template">
        <field name="name">Shipment Confirmation</field>
        <field name="model_id" ref="shipping_management_system.model_shipment_order"/>
        <field name="subject">Shipment Confirmation - ${object.order_number}</field>
        <field name="email_from">${(object.company_id.email or user.email) | safe}</field>
        <field name="email_to">${object.sender_id.email | safe}</field>
        <field name="body_html"><![CDATA[
            <p>Dear ${object.sender_id.name},</p>
            <p>Your shipment request has been received successfully.</p>
            <p><strong>Shipment Details:</strong></p>
            <ul>
                <li>Order Number: ${object.order_number}</li>
                <li>From: ${object.sender_city}</li>
                <li>To: ${object.recipient_city}</li>
                <li>Pickup Date: ${object.pickup_date}</li>
            </ul>
            <p>You can track your shipment using this number: <strong>${object.order_number}</strong></p>
            <p>Thank you for choosing our services!</p>
        ]]></field>
        <field name="auto_delete" eval="False"/>
    </record>
</odoo>