<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="shipping_management_system.ShipmentDashboard">
        <!-- Main Dashboard Container -->
        <div class="o_shipment_dashboard">
            <!-- Loading State -->
            <div t-if="state.isLoading" class="dashboard-loading-container">
                <div class="loading-content">
                    <div class="loading-spinner">
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                        <div class="spinner-ring"></div>
                    </div>
                    <h3 class="loading-text">Loading Dashboard...</h3>
                    <p class="loading-subtext">Fetching your shipment data</p>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div t-else="" class="dashboard-container">
                <!-- Modern Header Section -->
                <div class="dashboard-header-modern">
                    <div class="header-background">
                        <div class="animated-bg"></div>
                    </div>

                    <div class="header-content">
                        <div class="container-fluid">
                            <!-- Top Bar -->
                            <div class="header-top-bar">
                                <div class="header-title-section">
                                    <div class="dashboard-logo">
                                        <i class="fa fa-ship"></i>
                                    </div>
                                    <div class="title-content">
                                        <h1 class="dashboard-title">Shipment Analytics</h1>
                                        <p class="dashboard-subtitle">Real-time tracking and insights</p>
                                    </div>
                                </div>

                                <div class="header-actions">
                                    <button class="btn-modern btn-refresh-modern" t-on-click="() => onRefreshClick()">
                                        <span class="btn-icon">
                                            <i class="fa fa-sync-alt"></i>
                                        </span>
                                        <span class="btn-text">Refresh</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Search and Filters Section -->
                            <div class="filters-modern-container">
                                <!-- Search Box -->
                                <div class="search-box-modern">
                                    <div class="search-icon">
                                        <i class="fa fa-search"></i>
                                    </div>
                                    <input type="text"
                                           t-ref="searchInput"
                                           class="search-input-modern"
                                           placeholder="Search orders, customers, tracking..."
                                           t-att-value="state.searchTerm"
                                           t-on-input="onSearchInput"/>
                                    <t t-if="state.searchTerm">
                                        <button class="search-clear" t-on-click="() => { state.searchTerm = ''; applyFilters(); }">
                                            <i class="fa fa-times"></i>
                                        </button>
                                    </t>
                                </div>

                                <!-- Filter Pills -->
                                <div class="filter-pills-container">
                                    <div class="filter-pill" t-att-class="state.dateFilter === 'today' ? 'active' : ''"
                                         t-on-click="() => { state.dateFilter = 'today'; applyFilters(); }">
                                        <i class="fa fa-calendar-day"></i>
                                        <span>Today</span>
                                    </div>
                                    <div class="filter-pill" t-att-class="state.dateFilter === 'week' ? 'active' : ''"
                                         t-on-click="() => { state.dateFilter = 'week'; applyFilters(); }">
                                        <i class="fa fa-calendar-week"></i>
                                        <span>This Week</span>
                                    </div>
                                    <div class="filter-pill" t-att-class="state.dateFilter === 'month' ? 'active' : ''"
                                         t-on-click="() => { state.dateFilter = 'month'; applyFilters(); }">
                                        <i class="fa fa-calendar-alt"></i>
                                        <span>This Month</span>
                                    </div>
                                    <div class="filter-pill" t-att-class="state.dateFilter === 'year' ? 'active' : ''"
                                         t-on-click="() => { state.dateFilter = 'year'; applyFilters(); }">
                                        <i class="fa fa-calendar"></i>
                                        <span>This Year</span>
                                    </div>
                                    <div class="filter-pill custom-pill" t-att-class="state.dateFilter === 'custom' ? 'active' : ''"
                                         t-on-click="() => { state.dateFilter = 'custom'; }">
                                        <i class="fa fa-cog"></i>
                                        <span>Custom</span>
                                    </div>
                                </div>

                                <!-- Custom Date Range -->
                                <div class="custom-date-container" t-if="state.dateFilter === 'custom'">
                                    <div class="date-input-group">
                                        <label>From</label>
                                        <input type="date"
                                               class="date-input-modern"
                                               t-att-value="state.startDate"
                                               t-on-change="(e) => { state.startDate = e.target.value; }"/>
                                    </div>
                                    <div class="date-range-separator">
                                        <i class="fa fa-arrow-right"></i>
                                    </div>
                                    <div class="date-input-group">
                                        <label>To</label>
                                        <input type="date"
                                               class="date-input-modern"
                                               t-att-value="state.endDate"
                                               t-on-change="(e) => { state.endDate = e.target.value; }"/>
                                    </div>
                                    <button class="btn-apply-dates" t-on-click="() => applyFilters()">
                                        <i class="fa fa-check"></i>
                                        Apply
                                    </button>
                                </div>

                                <!-- Active Filters Summary -->
                                <div class="filters-summary">
                                    <div class="summary-item total">
                                        <i class="fa fa-box"></i>
                                        <span class="label">Total Found:</span>
                                        <span class="value" t-esc="state.dashboardData.total_count || 0"/>
                                    </div>
                                    <t t-if="state.searchTerm">
                                        <div class="summary-item">
                                            <i class="fa fa-search"></i>
                                            <span class="value" t-esc="state.searchTerm"/>
                                            <button class="remove-filter" t-on-click="() => { state.searchTerm = ''; applyFilters(); }">
                                                <i class="fa fa-times"></i>
                                            </button>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content Area -->
                <div class="dashboard-content-area">
                    <div class="container-fluid">
                        <!-- KPI Cards Section -->
                        <div class="kpi-section">
                            <div class="row g-4">
                                <!-- Total Orders Card -->
                                <div class="col-xl-3 col-lg-6">
                                    <div class="kpi-card-modern" t-on-click="() => viewTodayShipments()">
                                        <div class="kpi-card-body">
                                            <div class="kpi-icon-wrapper color-primary">
                                                <i class="fa fa-shopping-cart"></i>
                                            </div>
                                            <div class="kpi-content">
                                                <h3 class="kpi-value">
                                                    <t t-esc="getTotalOrdersCount()"/>
                                                </h3>
                                                <p class="kpi-label">Total Orders</p>
                                                <span class="kpi-badge">
                                                    <i class="fa fa-clock"></i>
                                                    <t t-esc="state.dateFilter"/>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="kpi-footer">
                                            <span class="footer-text">View Details</span>
                                            <i class="fa fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- In Transit Card -->
                                <div class="col-xl-3 col-lg-6">
                                    <div class="kpi-card-modern" t-on-click="() => viewInTransit()">
                                        <div class="kpi-card-body">
                                            <div class="kpi-icon-wrapper color-warning">
                                                <i class="fa fa-truck"></i>
                                            </div>
                                            <div class="kpi-content">
                                                <h3 class="kpi-value">
                                                    <t t-esc="getInTransitCount()"/>
                                                </h3>
                                                <p class="kpi-label">In Transit</p>
                                                <span class="kpi-badge badge-warning">
                                                    <i class="fa fa-route"></i>
                                                    On the way
                                                </span>
                                            </div>
                                        </div>
                                        <div class="kpi-footer">
                                            <span class="footer-text">Track Shipments</span>
                                            <i class="fa fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Delivered Card -->
                                <div class="col-xl-3 col-lg-6">
                                    <div class="kpi-card-modern" t-on-click="() => viewDeliveredToday()">
                                        <div class="kpi-card-body">
                                            <div class="kpi-icon-wrapper color-success">
                                                <i class="fa fa-check-circle"></i>
                                            </div>
                                            <div class="kpi-content">
                                                <h3 class="kpi-value">
                                                    <t t-esc="getDeliveredCount()"/>
                                                </h3>
                                                <p class="kpi-label">Delivered</p>
                                                <span class="kpi-badge badge-success">
                                                    <i class="fa fa-check"></i>
                                                    Completed
                                                </span>
                                            </div>
                                        </div>
                                        <div class="kpi-footer">
                                            <span class="footer-text">View All</span>
                                            <i class="fa fa-arrow-right"></i>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- Status Distribution Section -->
                        <div class="status-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fa fa-chart-pie"></i>
                                    Order Status Distribution
                                </h2>
                                <div class="section-badge">
                                    <span class="badge-modern">
                                        Total: <strong t-esc="state.dashboardData.total_count || 0"/>
                                    </span>
                                </div>
                            </div>

                            <div class="status-grid">
                                <t t-foreach="state.dashboardData.states || []" t-as="status" t-key="status.state">
                                    <div class="status-card-modern" t-on-click="() => viewShipmentsByStatus(status.state)">
                                        <div class="status-icon" t-att-class="'color-' + status.color">
                                            <i t-att-class="'fa ' + status.icon"/>
                                        </div>
                                        <div class="status-content">
                                            <h4 class="status-value" t-esc="status.count"/>
                                            <p class="status-name" t-esc="status.name"/>
                                        </div>
                                        <div class="status-progress">
                                            <div class="progress-bar" t-att-style="'width: ' + status.percentage + '%'" t-att-class="'bg-' + status.color"></div>
                                        </div>
                                        <span class="status-percentage" t-esc="status.percentage + '%'"/>
                                    </div>
                                </t>
                            </div>
                        </div>

                        <!-- Recent Shipments Table -->
                        <div class="table-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fa fa-list"></i>
                                    Recent Shipments
                                </h2>
                                <button class="btn-view-all" t-on-click="() => viewAllShipments()">
                                    View All <t t-esc="state.dashboardData.total_count || 0"/> Orders
                                    <i class="fa fa-arrow-right"></i>
                                </button>
                            </div>

                            <div class="table-modern-container">
                                <table class="table-modern">
                                    <thead>
                                        <tr>
                                            <th>ORDER #</th>
                                            <th>DATE</th>
                                            <th>SENDER</th>
                                            <th>RECIPIENT</th>
                                            <th>STATUS</th>
                                            <th>AMOUNT</th>
                                            <th>ACTIONS</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-set="shipments" t-value="state.dashboardData.today_shipments || state.dashboardData.recent_shipments || []"/>
                                        <t t-if="shipments.length > 0">
                                            <t t-foreach="shipments" t-as="shipment" t-key="shipment.id">
                                                <tr class="table-row-modern">
                                                    <td class="order-number">
                                                        <span class="order-badge" t-on-click="() => viewShipment(shipment.id)">
                                                            <t t-esc="shipment.order_number"/>
                                                        </span>
                                                    </td>
                                                    <td class="date-cell">
                                                        <t t-esc="formatDate(shipment.create_date)"/>
                                                    </td>
                                                    <td class="sender-cell" t-esc="shipment.sender"/>
                                                    <td class="recipient-cell" t-esc="shipment.recipient"/>
                                                    <td class="status-cell">
                                                        <span t-att-class="'status-badge badge-' + getStatusColor(shipment.state)">
                                                            <t t-esc="shipment.state_name"/>
                                                        </span>
                                                    </td>
                                                    <td class="amount-cell">
                                                        <strong t-esc="formatCurrency(shipment.amount)"/>
                                                    </td>
                                                    <td class="actions-cell">
                                                        <button class="btn-action-modern" t-on-click="() => viewShipment(shipment.id)">
                                                            <i class="fa fa-eye"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <tr>
                                                <td colspan="7" class="empty-state">
                                                    <div class="empty-icon">
                                                        <i class="fa fa-inbox"></i>
                                                    </div>
                                                    <p>No shipments found for selected filters</p>
                                                </td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>