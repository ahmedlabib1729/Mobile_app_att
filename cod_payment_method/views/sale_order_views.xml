<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- تعديل فورم Sale Order -->
    <record id="sale_order_form_cod" model="ir.ui.view">
        <field name="name">sale.order.form.cod</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <!-- إضافة حقل COD في معلومات الطلب -->
            <xpath expr="//field[@name='payment_term_id']" position="after">
                <field name="has_cod_fee" invisible="1"/>
                <field name="cod_fee_line_id" invisible="1"/>
                <div class="alert alert-warning" role="alert" invisible="not has_cod_fee">
                    <i class="fa fa-info-circle"/> This order includes Cash on Delivery fee
                </div>
            </xpath>

            <!-- تمييز سطر رسوم COD في جدول المنتجات -->
            <xpath expr="//field[@name='order_line']/tree/field[@name='name']" position="after">
                <field name="is_cod_fee" invisible="1"/>
            </xpath>

            <!-- تلوين سطر رسوم COD -->
            <xpath expr="//field[@name='order_line']/tree" position="attributes">
                <attribute name="decoration-info">is_cod_fee == True</attribute>
            </xpath>
        </field>
    </record>

    <!-- إضافة Smart Button لـ COD Orders -->
    <record id="sale_order_view_form_cod_button" model="ir.ui.view">
        <field name="name">sale.order.form.cod.button</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_view_cod_details"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-money"
                        invisible="not has_cod_fee"
                        string="COD">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_text">COD</span>
                    </div>
                </button>
            </xpath>
        </field>
    </record>

    <!-- Search view لـ Sale Orders مع COD -->
    <record id="sale_order_search_cod" model="ir.ui.view">
        <field name="name">sale.order.search.cod</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_sales_order_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='my_sale_orders_filter']" position="after">
                <separator/>
                <filter string="COD Orders" name="cod_orders" domain="[('has_cod_fee', '=', True)]"/>
                <filter string="Non-COD Orders" name="non_cod_orders" domain="[('has_cod_fee', '=', False)]"/>
            </xpath>
        </field>
    </record>

    <!-- Tree view مع عمود COD -->
    <record id="sale_order_tree_cod" model="ir.ui.view">
        <field name="name">sale.order.tree.cod</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='amount_total']" position="after">
                <field name="has_cod_fee" string="COD" widget="boolean_toggle" optional="show"/>
            </xpath>
        </field>
    </record>

    <!-- Kanban view مع badge COD -->
    <record id="sale_order_kanban_cod" model="ir.ui.view">
        <field name="name">sale.order.kanban.cod</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_sale_order_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='currency_id']" position="after">
                <field name="has_cod_fee"/>
            </xpath>
            <xpath expr="//div[hasclass('o_kanban_record_bottom')]" position="inside">
                <div t-if="record.has_cod_fee.raw_value" class="oe_kanban_bottom_left">
                    <span class="badge badge-info"><i class="fa fa-money"/> COD</span>
                </div>
            </xpath>
        </field>
    </record>

    <!-- Action لعرض COD Orders -->
    <record id="action_cod_orders" model="ir.actions.act_window">
        <field name="name">COD Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
        <field name="domain">[('has_cod_fee', '=', True)]</field>
        <field name="context">{'search_default_cod_orders': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Cash on Delivery orders found
            </p>
            <p>
                Orders with Cash on Delivery payment method will appear here.
            </p>
        </field>
    </record>

    <!-- Menu item -->
    <menuitem id="menu_cod_orders"
              name="COD Orders"
              parent="sale.sale_order_menu"
              action="action_cod_orders"
              sequence="10"/>
</odoo>