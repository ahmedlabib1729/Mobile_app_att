<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- List View -->
        <record id="view_shipping_order_list" model="ir.ui.view">
            <field name="name">shipping.order.list</field>
            <field name="model">shipping.order</field>
            <field name="arch" type="xml">
                <list string="Shipping Orders" decoration-success="state=='delivered'"
                      decoration-warning="state in ['in_transit','out_for_delivery']"
                      decoration-danger="state=='cancelled'"
                      decoration-info="state=='draft'">
                    <field name="order_number"/>
                    <field name="customer_id"/>
                    <field name="order_date"/>
                    <field name="sender_name"/>
                    <field name="receiver_name"/>
                    <field name="receiver_city"/>
                    <field name="shipping_company_id"/>
                    <field name="shipping_type"/>
                    <field name="tracking_number"/>
                    <field name="total_amount" sum="Total"/>
                    <field name="state" widget="badge" decoration-success="state=='delivered'"
                           decoration-warning="state in ['in_transit','out_for_delivery']"
                           decoration-danger="state=='cancelled'"
                           decoration-info="state=='draft'"/>
                </list>
            </field>
        </record>

        <!-- Form View -->
        <record id="view_shipping_order_form" model="ir.ui.view">
            <field name="name">shipping.order.form</field>
            <field name="model">shipping.order</field>
            <field name="arch" type="xml">
                <form string="Shipping Order">
                    <header>
                        <button name="action_confirm" string="Confirm Order" type="object"
                                class="btn-primary" invisible="state != 'draft'"/>
                        <button name="action_set_delivered" string="Mark as Delivered" type="object"
                                class="btn-success" invisible="state not in ['in_transit','out_for_delivery']"/>
                        <button name="action_return" string="Return" type="object"
                                invisible="state != 'delivered'"/>
                        <button name="action_cancel" string="Cancel" type="object"
                                invisible="state not in ['draft','confirmed','picked']"/>
                        <button name="action_print_label" string="Print Label" type="object"
                                class="btn-secondary" invisible="state not in ['confirmed','picked','in_transit','out_for_delivery','delivered']"/>
                        <button name="action_track_shipment" string="Track Shipment" type="object"
                                invisible="not tracking_number"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,in_transit,delivered"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_customer_profile" type="object"
                                    class="oe_stat_button" icon="fa-user">
                                <div class="o_stat_info">
                                    <field name="customer_type" class="o_stat_value"/>
                                    <span class="o_stat_text">Customer Type</span>
                                </div>
                            </button>
                            <button name="action_view_product_analysis" type="object"
                                    class="oe_stat_button" icon="fa-bar-chart">
                                <div class="o_stat_info">
                                    <field name="products_count" class="o_stat_value"/>
                                    <span class="o_stat_text">Products</span>
                                </div>
                            </button>
                        </div>
                        <widget name="web_ribbon" title="Delivered" bg_color="bg-success"
                                invisible="state != 'delivered'"/>
                        <widget name="web_ribbon" title="Cancelled" bg_color="bg-danger"
                                invisible="state != 'cancelled'"/>
                        <div class="oe_title">
                            <h1>
                                <field name="order_number" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group string="Customer Information">
                                <field name="customer_id" options="{'no_create': True}"/>
                                <field name="order_date"/>
                                <field name="expected_delivery_date"/>
                                <field name="delivery_date" invisible="not delivery_date"/>
                            </group>
                            <group string="Shipping Details">
                                <field name="shipping_company_id" options="{'no_create': True}"/>
                                <field name="shipping_type"/>
                                <field name="tracking_number" invisible="not tracking_number"/>
                                <field name="external_tracking_number" invisible="not external_tracking_number"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Sender &amp; Receiver Information">
                                <group>
                                    <group string="Sender Information">
                                        <field name="sender_name"/>
                                        <field name="sender_phone"/>
                                        <field name="sender_email"/>
                                        <field name="sender_governorate" options="{'no_create': True}"/>
                                        <field name="sender_city"/>
                                        <field name="sender_address"/>
                                    </group>
                                    <group string="Receiver Information">
                                        <field name="same_as_sender"/>
                                        <field name="receiver_name" readonly="same_as_sender"/>
                                        <field name="receiver_phone" readonly="same_as_sender"/>
                                        <field name="receiver_email" readonly="same_as_sender"/>
                                        <field name="receiver_governorate" options="{'no_create': True}"
                                               readonly="same_as_sender"/>
                                        <field name="receiver_city" readonly="same_as_sender"/>
                                        <field name="receiver_address" readonly="same_as_sender"/>
                                    </group>
                                </group>
                            </page>

                            <page string="Products">
                                <field name="order_line_ids">
                                    <list string="Products" editable="bottom">
                                        <field name="sequence" widget="handle"/>
                                        <field name="product_template_id" optional="show"/>
                                        <field name="product_name"/>
                                        <field name="category_id" options="{'no_create': True}"/>
                                        <field name="subcategory_id" options="{'no_create': True}"/>
                                        <field name="brand"/>
                                        <field name="model_number" optional="hide"/>
                                        <field name="quantity"/>
                                        <field name="unit_price"/>
                                        <field name="weight"/>
                                        <field name="subtotal" sum="Total"/>
                                        <field name="is_fragile" optional="show"/>
                                        <field name="save_as_template"/>
                                    </list>
                                    <form string="Product Details">
                                        <group>
                                            <group>
                                                <field name="product_template_id"/>
                                                <field name="product_name"/>
                                                <field name="category_id" options="{'no_create': True}"/>
                                                <field name="subcategory_id" options="{'no_create': True}"/>
                                                <field name="brand"/>
                                                <field name="model_number"/>
                                            </group>
                                            <group>
                                                <field name="quantity"/>
                                                <field name="unit_price"/>
                                                <field name="subtotal"/>
                                                <field name="weight"/>
                                                <field name="is_fragile"/>
                                                <field name="requires_battery"/>
                                                <field name="save_as_template"/>
                                            </group>
                                        </group>
                                        <group string="Dimensions" col="4">
                                            <field name="length"/>
                                            <field name="width"/>
                                            <field name="height"/>
                                        </group>
                                        <group string="Description">
                                            <field name="description" nolabel="1"/>
                                        </group>
                                    </form>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="products_value" widget="monetary"/>
                                    <div class="oe_subtotal_footer_separator oe_inline">
                                        <label for="shipping_cost"/>
                                    </div>
                                    <field name="shipping_cost" nolabel="1" widget="monetary"/>
                                    <div class="oe_subtotal_footer_separator oe_inline">
                                        <label for="additional_services_cost"/>
                                    </div>
                                    <field name="additional_services_cost" nolabel="1" widget="monetary"/>
                                    <div class="oe_subtotal_footer_separator oe_inline">
                                        <label for="total_amount" class="font-weight-bold"/>
                                    </div>
                                    <field name="total_amount" nolabel="1" widget="monetary" class="font-weight-bold"/>
                                </group>
                                <div class="clearfix"/>
                            </page>

                            <page string="Additional Services &amp; Payment">
                                <group>
                                    <group string="Additional Services">
                                        <field name="special_packaging"/>
                                        <field name="insurance"/>
                                        <field name="open_package"/>
                                    </group>
                                    <group string="Payment Information">
                                        <field name="payment_method"/>
                                        <field name="cod_amount" invisible="payment_method != 'cod'"
                                                                          required="payment_method == 'cod'"/>
                                        <field name="total_weight"/>
                                    </group>
                                </group>
                            </page>

                            <page string="Notes">
                                <group>
                                    <field name="internal_notes" placeholder="Internal notes (not visible to customer)..."/>
                                    <field name="delivery_notes" placeholder="Delivery instructions..."/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Search View -->
        <record id="view_shipping_order_search" model="ir.ui.view">
            <field name="name">shipping.order.search</field>
            <field name="model">shipping.order</field>
            <field name="arch" type="xml">
                <search string="Search Shipping Orders">
                    <field name="order_number"/>
                    <field name="customer_id"/>
                    <field name="sender_name"/>
                    <field name="receiver_name"/>
                    <field name="tracking_number"/>
                    <field name="receiver_city"/>
                    <field name="receiver_governorate"/>
                    <separator/>
                    <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Confirmed" name="confirmed" domain="[('state','=','confirmed')]"/>
                    <filter string="In Transit" name="in_transit" domain="[('state','=','in_transit')]"/>
                    <filter string="Delivered" name="delivered" domain="[('state','=','delivered')]"/>
                    <filter string="Cancelled" name="cancelled" domain="[('state','=','cancelled')]"/>
                    <separator/>
                    <filter string="Today" name="today" domain="[('order_date','&gt;=',context_today().strftime('%Y-%m-%d'))]"/>
                    <filter string="This Week" name="this_week"
                            domain="[('order_date','&gt;=',(context_today()-datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Month" name="this_month"
                            domain="[('order_date','&gt;=',(context_today().replace(day=1)).strftime('%Y-%m-%d'))]"/>
                    <separator/>
                    <filter string="Normal Shipping" name="normal" domain="[('shipping_type','=','normal')]"/>
                    <filter string="Express Shipping" name="express" domain="[('shipping_type','=','express')]"/>
                    <filter string="Same Day" name="same_day" domain="[('shipping_type','=','same_day')]"/>
                    <separator/>
                    <filter string="COD Orders" name="cod" domain="[('payment_method','=','cod')]"/>
                    <filter string="Prepaid Orders" name="prepaid" domain="[('payment_method','=','prepaid')]"/>
                    <group expand="0" string="Group By">
                        <filter string="Customer" name="group_customer" context="{'group_by':'customer_id'}"/>
                        <filter string="State" name="group_state" context="{'group_by':'state'}"/>
                        <filter string="Shipping Company" name="group_company" context="{'group_by':'shipping_company_id'}"/>
                        <filter string="Shipping Type" name="group_type" context="{'group_by':'shipping_type'}"/>
                        <filter string="Payment Method" name="group_payment" context="{'group_by':'payment_method'}"/>
                        <filter string="Order Date" name="group_date" context="{'group_by':'order_date:day'}"/>
                        <filter string="Governorate" name="group_governorate" context="{'group_by':'receiver_governorate'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Kanban View -->
        <record id="view_shipping_order_kanban" model="ir.ui.view">
            <field name="name">shipping.order.kanban</field>
            <field name="model">shipping.order</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_mobile">
                    <field name="order_number"/>
                    <field name="customer_id"/>
                    <field name="receiver_name"/>
                    <field name="receiver_city"/>
                    <field name="total_amount"/>
                    <field name="state"/>
                    <field name="tracking_number"/>
                    <field name="shipping_type"/>
                    <progressbar field="state"
                                 colors='{"draft": "secondary", "confirmed": "primary", "in_transit": "warning", "delivered": "success", "cancelled": "danger"}'/>
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_global_click">
                                <div class="o_kanban_record_top mb-0">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="order_number"/>
                                        </strong>
                                    </div>
                                    <field name="state" widget="label_selection"
                                           options="{'classes': {'draft': 'secondary', 'confirmed': 'primary', 'in_transit': 'warning', 'delivered': 'success', 'cancelled': 'danger'}}"/>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div>
                                        <i class="fa fa-user" title="Customer"/> <field name="customer_id"/>
                                    </div>
                                    <div>
                                        <i class="fa fa-map-marker" title="Destination"/> To: <field name="receiver_name"/> - <field name="receiver_city"/>
                                    </div>
                                    <div invisible="not tracking_number">
                                        <i class="fa fa-barcode" title="Tracking"/> <field name="tracking_number"/>
                                    </div>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="shipping_type" widget="badge"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <strong><field name="total_amount" widget="monetary"/></strong>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Calendar View -->


        <!-- Pivot View -->
        <record id="view_shipping_order_pivot" model="ir.ui.view">
            <field name="name">shipping.order.pivot</field>
            <field name="model">shipping.order</field>
            <field name="arch" type="xml">
                <pivot string="Shipping Analysis">
                    <field name="shipping_company_id" type="row"/>
                    <field name="state" type="col"/>
                    <field name="total_amount" type="measure"/>
                    <field name="products_count" type="measure"/>
                </pivot>
            </field>
        </record>

        <!-- Graph View -->
        <record id="view_shipping_order_graph" model="ir.ui.view">
            <field name="name">shipping.order.graph</field>
            <field name="model">shipping.order</field>
            <field name="arch" type="xml">
                <graph string="Shipping Orders" type="bar" stacked="True">
                    <field name="order_date" interval="day"/>
                    <field name="total_amount" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- Actions -->
        <record id="action_shipping_order" model="ir.actions.act_window">
            <field name="name">Shipping Orders</field>
            <field name="res_model">shipping.order</field>
            <field name="view_mode">list,kanban,form,pivot,graph</field>
            <field name="search_view_id" ref="view_shipping_order_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create your first shipping order
                </p>
                <p>
                    Start managing your shipping operations efficiently with our comprehensive shipping management system.
                </p>
            </field>
        </record>

        <!-- Today's Orders Action -->
        <record id="action_today_shipping_orders" model="ir.actions.act_window">
            <field name="name">Today's Orders</field>
            <field name="res_model">shipping.order</field>
            <field name="view_mode">list,kanban,form</field>
            <field name="domain">[('order_date', '&gt;=', context_today().strftime('%Y-%m-%d 00:00:00')),
                                   ('order_date', '&lt;=', context_today().strftime('%Y-%m-%d 23:59:59'))]</field>
            <field name="context">{'search_default_group_state': 1}</field>
        </record>

        <!-- Pending Delivery Action -->
        <record id="action_pending_delivery_orders" model="ir.actions.act_window">
            <field name="name">Pending Delivery</field>
            <field name="res_model">shipping.order</field>
            <field name="view_mode">list,kanban,form</field>
            <field name="domain">[('state', 'in', ['confirmed', 'picked', 'in_transit', 'out_for_delivery'])]</field>
            <field name="context">{'search_default_group_state': 1}</field>
        </record>

    </data>
</odoo>